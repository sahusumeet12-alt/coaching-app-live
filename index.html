<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UNIQUE STUDY POINT</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:#f0f2f5;min-height:100vh}.container{max-width:500px;margin:0 auto}.login-page{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;align-items:center;padding:40px 20px}.logo{width:100px;height:100px;background:linear-gradient(135deg,#ff9a56,#ff6b6b);border-radius:25px;display:flex;align-items:center;justify-content:center;margin-bottom:20px;box-shadow:0 15px 35px rgba(0,0,0,0.3)}.logo span{font-size:36px;font-weight:800;color:#fff}.brand{text-align:center;color:#fff;margin-bottom:25px}.brand h1{font-size:22px}.brand a{color:#ffd700;text-decoration:none}.login-card{background:#fff;border-radius:28px;padding:30px;width:100%}.tabs{display:flex;gap:12px;margin-bottom:20px}.tab-btn{flex:1;padding:15px;border:none;border-radius:16px;background:#f0f2f5;cursor:pointer;font-family:inherit;transition:all .3s}.tab-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.tab-btn .icon{font-size:24px;display:block;margin-bottom:4px}.tab-btn .label{font-size:13px;font-weight:700}.status{text-align:center;padding:10px;border-radius:12px;margin-bottom:18px;font-size:12px;font-weight:600;background:#d4fc79;color:#2d5a3d}.form-group{margin-bottom:18px}.form-group label{display:block;font-size:12px;font-weight:700;color:#667eea;margin-bottom:6px}.form-group input,.form-group select,.form-group textarea{width:100%;padding:14px;border:2px solid #e8e8e8;border-radius:14px;font-size:15px;font-family:inherit}.btn{width:100%;padding:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer}.btn:active{transform:scale(0.98)}.btn-sms{background:linear-gradient(135deg,#ff6b6b,#ee5a5a)}.btn-wa{background:linear-gradient(135deg,#25D366,#128C7E)}.btn-dl{background:linear-gradient(135deg,#f093fb,#f5576c)}.btn-green{background:linear-gradient(135deg,#11998e,#38ef7d)}.btn-small{padding:10px 16px;font-size:12px;width:auto;border-radius:10px;border:none;cursor:pointer;font-weight:600;color:#fff}.btn-del{background:linear-gradient(135deg,#ff6b6b,#ee5a5a)}.dashboard{display:none}.dashboard.active{display:block}.header{background:linear-gradient(135deg,#667eea,#764ba2);padding:25px 20px;color:#fff;text-align:center;position:relative}.header h1{font-size:20px}.logout-btn{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);border:none;color:#fff;padding:8px 14px;border-radius:10px;cursor:pointer}.profile-pic{width:80px;height:80px;border-radius:50%;border:3px solid #fff;margin:0 auto 12px;background:#ff9a56;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:800;color:#fff;overflow:hidden}.profile-pic img{width:100%;height:100%;object-fit:cover}.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:15px 20px}.stat{background:#fff;padding:15px;border-radius:16px;text-align:center}.stat-val{font-size:20px;font-weight:800;color:#667eea}.stat-lbl{font-size:9px;color:#888;font-weight:600}.section{padding:0 20px}.section-title{font-size:15px;font-weight:700;color:#667eea;margin:18px 0 12px}.actions{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}.action{background:#fff;border:none;padding:20px;border-radius:16px;text-align:center;cursor:pointer;font-family:inherit}.action-icon{font-size:28px;margin-bottom:6px}.action-label{font-size:11px;font-weight:700}.list{padding:0 20px}.card{background:#fff;border-radius:16px;padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px}.avatar{width:46px;height:46px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;flex-shrink:0;overflow:hidden}.avatar img{width:100%;height:100%;object-fit:cover}.card-info{flex:1;min-width:0}.card-title{font-weight:600;color:#333;font-size:13px}.card-sub{font-size:10px;color:#888}.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:500px;background:#fff;padding:10px;display:flex;justify-content:space-around;box-shadow:0 -8px 30px rgba(0,0,0,0.1);border-radius:22px 22px 0 0;z-index:100}.nav-item{display:flex;flex-direction:column;align-items:center;background:transparent;border:none;cursor:pointer;padding:6px 10px;border-radius:12px;font-family:inherit}.nav-item.active{background:rgba(102,126,234,0.15)}.nav-item span:first-child{font-size:20px}.nav-item span:last-child{font-size:8px;font-weight:700;color:#888}.nav-item.active span:last-child{color:#667eea}.page{display:none;padding-bottom:85px}.page.active{display:block}.filter-row{display:flex;gap:8px;padding:0 20px;margin-bottom:12px;flex-wrap:wrap}.filter-btn{padding:8px 14px;border:2px solid #e8e8e8;border-radius:25px;background:#fff;font-size:11px;font-weight:600;cursor:pointer}.filter-btn.active{border-color:#667eea;background:#667eea;color:#fff}.fee-card{background:linear-gradient(135deg,#667eea,#764ba2);margin:0 20px 15px;padding:22px;border-radius:18px;color:#fff}.fee-amt{font-size:32px;font-weight:800}.fee-status{display:inline-block;padding:5px 12px;background:rgba(255,255,255,0.2);border-radius:15px;font-size:11px;margin-top:8px}.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;padding:15px}.modal.active{display:flex}.modal-content{background:#fff;border-radius:22px;width:100%;max-width:420px;max-height:85vh;overflow-y:auto}.modal-header{padding:18px;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}.modal-title{font-size:16px;font-weight:700;color:#667eea}.modal-close{background:#ff6b6b;border:none;color:#fff;width:32px;height:32px;border-radius:8px;cursor:pointer;font-size:16px}.modal-body{padding:18px}.modal-footer{padding:12px 18px 18px;display:flex;gap:8px;flex-wrap:wrap}.modal-footer .btn{flex:1;padding:12px;min-width:45%}.toast{position:fixed;top:15px;left:50%;transform:translateX(-50%) translateY(-100px);background:#667eea;color:#fff;padding:12px 22px;border-radius:12px;font-size:13px;font-weight:600;z-index:2000;transition:transform .3s}.toast.show{transform:translateX(-50%) translateY(0)}.toast.success{background:#25D366}.toast.error{background:#ff6b6b}.empty{text-align:center;padding:40px;color:#888}.tpl-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}.tpl-section{margin-bottom:10px}.tpl-title{font-size:10px;font-weight:700;color:#888;margin-bottom:6px}.alert-tpl{padding:8px 4px;border:none;border-radius:10px;cursor:pointer;text-align:center;font-family:inherit}.alert-tpl .alert-icon{font-size:16px}.alert-tpl .alert-label{font-size:7px;font-weight:600;color:#333}.tpl-neg{background:linear-gradient(135deg,#ffecd2,#fcb69f)}.tpl-pos{background:linear-gradient(135deg,#d4fc79,#96e6a1)}.tpl-info{background:linear-gradient(135deg,#a1c4fd,#c2e9fb)}.tpl-warn{background:linear-gradient(135deg,#fff3b0,#ffd93d)}.test-card,.ws-card{background:#fff;border-radius:16px;padding:16px;margin-bottom:12px;border-left:4px solid #667eea}.upload-box{background:linear-gradient(135deg,#667eea15,#764ba215);border:2px dashed #667eea;border-radius:16px;padding:30px;text-align:center;cursor:pointer;margin-bottom:15px}.file-preview{background:#f0f2f5;border-radius:12px;padding:12px;margin-bottom:15px;display:none;align-items:center;gap:10px}.photo-upload{width:80px;height:80px;border-radius:50%;border:3px dashed #667eea;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;background:#f0f2f5}.photo-upload img{width:100%;height:100%;object-fit:cover}.report-header{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:20px;text-align:center;color:#fff;border-radius:16px 16px 0 0}.report-logo{width:50px;height:50px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;margin:0 auto 10px;display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;color:#fff}.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;background:#f8f9fa;padding:15px;font-size:11px}.info-grid div{padding:5px}.info-label{color:#888;font-size:9px}.info-val{font-weight:600;color:#333}.result-table{width:100%;border-collapse:collapse;font-size:11px;margin:15px 0}.result-table th{background:#667eea;color:#fff;padding:10px 8px;text-align:left;font-size:10px}.result-table td{padding:10px 8px;border-bottom:1px solid #eee}.result-table tr:nth-child(even){background:#f8f9fa}.grade-badge{display:inline-block;padding:3px 8px;border-radius:5px;font-weight:700;font-size:10px}.summary-box{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:15px;border-radius:12px;margin:15px;display:grid;grid-template-columns:repeat(4,1fr);text-align:center;gap:10px}.summary-item{padding:8px}.summary-val{font-size:18px;font-weight:800}.summary-lbl{font-size:8px;opacity:0.9}.remark-box{background:#f0f8ff;border-left:4px solid #667eea;padding:15px;margin:15px;border-radius:0 12px 12px 0}.alert-card{background:#fff;border-radius:12px;padding:12px;margin-bottom:8px;border-left:4px solid #ff6b6b}.alert-card.positive{border-left-color:#25D366}.alert-card.info{border-left-color:#667eea}
</style>
</head>
<body>
<div class="container">
<div class="login-page" id="loginPage">
<div class="logo"><span>USP</span></div>
<div class="brand"><h1>âœ¨ UNIQUE STUDY POINT</h1><p>By Sumeet Sahu</p><p style="margin-top:8px"><a href="https://uniquestudyonline.com" target="_blank">ğŸŒ uniquestudyonline.com</a></p></div>
<div class="login-card">
<div class="tabs"><button class="tab-btn active" id="parentTab" onclick="ut='parent';this.classList.add('active');document.getElementById('adminTab').classList.remove('active')"><span class="icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span><span class="label">Parent</span></button><button class="tab-btn" id="adminTab" onclick="ut='admin';this.classList.add('active');document.getElementById('parentTab').classList.remove('active')"><span class="icon">ğŸ‘¨â€ğŸ’¼</span><span class="label">Admin</span></button></div>
<div class="status" id="connStatus">â— Connecting...</div>
<div class="form-group"><label>USER ID</label><input type="text" id="userId" placeholder="Enter User ID"></div>
<div class="form-group"><label>PASSWORD</label><input type="password" id="password" placeholder="Enter Password"></div>
<button class="btn" id="loginBtn" onclick="doLogin()">ğŸš€ Login</button>
</div></div>
<!-- Parent Dashboard with 5 tabs -->
<div class="dashboard" id="parentDash">
<div class="page active" id="pHome"><div class="header"><button class="logout-btn" onclick="logout()">ğŸšª</button><div class="profile-pic" id="pPhoto"><span id="pInit">S</span></div><h1 id="pWelcome">Welcome</h1><p>UNIQUE STUDY POINT</p></div><div class="stats"><div class="stat"><div class="stat-val" id="pAttDays">0</div><div class="stat-lbl">DAYS PRESENT</div></div><div class="stat"><div class="stat-val" id="pAvgPct">0%</div><div class="stat-lbl">AVG SCORE</div></div><div class="stat"><div class="stat-val" id="pTestCnt">0</div><div class="stat-lbl">TESTS</div></div></div><div class="section"><h3 class="section-title">ğŸ”” Recent Alerts</h3></div><div class="list" id="notifList"></div></div>
<div class="page" id="pResults"><div class="header"><h1>ğŸ“ Results</h1></div><div class="filter-row" id="resFilters" style="padding-top:15px"></div><div id="resultsContent"></div></div>
<div class="page" id="pSheets"><div class="header"><h1>ğŸ“š Study Materials</h1></div><div class="filter-row" id="pWsFilters" style="padding-top:15px"></div><div class="list" id="pWsList"></div></div>
<div class="page" id="pAlerts"><div class="header"><h1>ğŸ”” Alert History</h1></div><div style="padding:15px 20px"><button class="btn btn-dl" onclick="downloadAlertPDF()">ğŸ“¥ Download Alert Report</button></div><div class="list" id="alertHistoryList"></div></div>
<div class="page" id="pFees"><div class="header"><h1>ğŸ’° Fees</h1></div><div class="fee-card"><div style="font-size:12px;opacity:0.9">Pending Amount</div><div class="fee-amt" id="feePend">â‚¹0</div><div class="fee-status" id="feeStat">Clear</div></div><div class="section"><h3 class="section-title">ğŸ’³ Payment History</h3></div><div class="list" id="feeList"></div></div>
<div class="nav" id="pNav"></div></div>
<!-- Admin Dashboard -->
<div class="dashboard" id="adminDash">
<div class="page active" id="aHome"><div class="header" style="padding-bottom:50px"><button class="logout-btn" onclick="logout()">ğŸšª</button><p>Admin Panel</p><h1>Sumeet Sahu</h1></div><div class="stats" style="margin-top:-30px"><div class="stat"><div class="stat-val" id="aStu">0</div><div class="stat-lbl">STUDENTS</div></div><div class="stat"><div class="stat-val" id="aPre">0</div><div class="stat-lbl">PRESENT</div></div><div class="stat"><div class="stat-val" id="aTst">0</div><div class="stat-lbl">TESTS</div></div></div><div class="section"><h3 class="section-title">âš¡ Quick Actions</h3><div class="actions" id="quickActions"></div><h3 class="section-title">ğŸ‘¨â€ğŸ“ Students</h3></div><div class="filter-row" id="clsFilters"></div><div class="list" id="aList"></div></div>
<div class="page" id="aAtt"><div class="header"><h1>ğŸ“‹ Attendance</h1></div><div class="section" style="padding-top:15px"><div class="form-group"><label>Select Date</label><input type="date" id="attD" onchange="renAtt()"></div><div style="display:flex;gap:8px"><button class="btn btn-sms" onclick="sendAttSMS()" style="flex:1">ğŸ“± SMS</button><button class="btn btn-wa" onclick="sendAttWA()" style="flex:1">ğŸ’¬ WA</button></div></div><div class="list" id="attL" style="margin-top:12px"></div></div>
<div class="page" id="aTests"><div class="header"><h1>ğŸ“ Tests</h1></div><div class="section" style="padding-top:15px"><button class="btn" onclick="openM('addTModal')">â• Create New Test</button></div><div class="list" id="testL" style="margin-top:12px"></div></div>
<div class="page" id="aWorksheets"><div class="header"><h1>ğŸ“š Worksheets</h1></div><div class="section" style="padding-top:15px"><button class="btn btn-green" onclick="openM('wsModal')">ğŸ“¤ Upload Worksheet</button></div><div class="filter-row" id="wsClsFilters" style="margin-top:15px"></div><div class="list" id="aWsList" style="margin-top:12px"></div></div>
<div class="page" id="aFees"><div class="header"><h1>ğŸ’° Fees</h1></div><div class="section" style="padding-top:15px"><button class="btn" onclick="ldDD();openM('addFModal')">ğŸ’° Record Payment</button></div><div class="list" id="feeL" style="margin-top:12px"></div></div>
<div class="nav" id="aNav"></div></div></div>
<!-- All Modals -->
<div class="modal" id="addSModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">â• Add Student</h2><button class="modal-close" onclick="closeM('addSModal')">Ã—</button></div><div class="modal-body"><div class="photo-upload" id="addPhotoBox" onclick="document.getElementById('addPhotoInput').click()"><span style="font-size:28px">ğŸ“·</span></div><input type="file" id="addPhotoInput" accept="image/*" style="display:none" onchange="upPhoto(this,'add')"><div class="form-group"><label>Full Name *</label><input type="text" id="sN"></div><div class="form-group"><label>Class *</label><select id="sC"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>XI</option><option>XII</option></select></div><div class="form-group"><label>Mobile *</label><input type="tel" id="sM" maxlength="10"></div><div class="form-group"><label>User ID *</label><input type="text" id="sU"></div><div class="form-group"><label>Password *</label><input type="text" id="sP"></div><div class="form-group"><label>Monthly Fee</label><input type="number" id="sFee" value="500"></div><div class="form-group"><label>Joining Date</label><input type="date" id="sJoin"></div></div><div class="modal-footer"><button class="btn" onclick="saveS()">Add Student</button></div></div></div>
<div class="modal" id="editSModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">âœï¸ Edit Student</h2><button class="modal-close" onclick="closeM('editSModal')">Ã—</button></div><div class="modal-body"><div class="photo-upload" id="editPhotoBox" onclick="document.getElementById('editPhotoInput').click()"><span style="font-size:28px">ğŸ“·</span></div><input type="file" id="editPhotoInput" accept="image/*" style="display:none" onchange="upPhoto(this,'edit')"><input type="hidden" id="editSId"><div class="form-group"><label>Full Name *</label><input type="text" id="editSN"></div><div class="form-group"><label>Class *</label><select id="editSC"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>XI</option><option>XII</option></select></div><div class="form-group"><label>Mobile *</label><input type="tel" id="editSM" maxlength="10"></div><div class="form-group"><label>User ID *</label><input type="text" id="editSU"></div><div class="form-group"><label>Password *</label><input type="text" id="editSP"></div><div class="form-group"><label>Monthly Fee</label><input type="number" id="editSFee"></div><div class="form-group"><label>Joining Date</label><input type="date" id="editSJoin"></div></div><div class="modal-footer"><button class="btn btn-green" onclick="updateS()">ğŸ’¾ Update</button><button class="btn btn-del" onclick="deleteS()">ğŸ—‘ï¸ Delete</button></div></div></div>
<div class="modal" id="addTModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">ğŸ“ Create Test</h2><button class="modal-close" onclick="closeM('addTModal')">Ã—</button></div><div class="modal-body"><div class="form-group"><label>Test Name *</label><input type="text" id="tN"></div><div class="form-group"><label>Subject *</label><select id="tSubjSel" onchange="document.getElementById('otherSubjG').style.display=this.value==='other'?'block':'none'"><option value="">Select</option><option value="Mathematics">Mathematics</option><option value="Science">Science</option><option value="Social Science">Social Science</option><option value="Hindi">Hindi</option><option value="English">English</option><option value="GK">GK</option><option value="other">Other</option></select></div><div class="form-group" id="otherSubjG" style="display:none"><label>Enter Subject</label><input type="text" id="tSOther"></div><div class="form-group"><label>Total Marks</label><input type="number" id="tM" value="50"></div><div class="form-group"><label>Test Date</label><input type="date" id="tD"></div><div class="form-group"><label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="tNotify" style="width:auto"> Notify parents</label></div></div><div class="modal-footer"><button class="btn" onclick="saveT()">Create Test</button></div></div></div>
<div class="modal" id="editTModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">âœï¸ Edit Test</h2><button class="modal-close" onclick="closeM('editTModal')">Ã—</button></div><div class="modal-body"><input type="hidden" id="editTId"><div class="form-group"><label>Test Name</label><input type="text" id="editTN"></div><div class="form-group"><label>Subject</label><input type="text" id="editTS"></div><div class="form-group"><label>Total Marks</label><input type="number" id="editTM"></div><div class="form-group"><label>Date</label><input type="date" id="editTD"></div></div><div class="modal-footer"><button class="btn btn-green" onclick="updateT()">ğŸ’¾ Update</button><button class="btn btn-del" onclick="deleteT()">ğŸ—‘ï¸ Delete</button></div></div></div>
<div class="modal" id="addMkModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">ğŸ“ <span id="mkTN"></span></h2><button class="modal-close" onclick="closeM('addMkModal')">Ã—</button></div><div class="modal-body"><div id="mkL"></div></div><div class="modal-footer"><button class="btn" onclick="saveMk()">ğŸ’¾ Save</button><button class="btn btn-sms" onclick="saveMk();setTimeout(sendMkSMS,500)">ğŸ“± SMS</button><button class="btn btn-wa" onclick="saveMk();setTimeout(sendMkWA,500)">ğŸ’¬ WA</button></div></div></div>
<div class="modal" id="addFModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">ğŸ’° Record Fee</h2><button class="modal-close" onclick="closeM('addFModal')">Ã—</button></div><div class="modal-body"><div class="form-group"><label>Student</label><select id="fStu"></select></div><div class="form-group"><label>Amount</label><input type="number" id="fAmt"></div><div class="form-group"><label>Date</label><input type="date" id="fDate"></div></div><div class="modal-footer"><button class="btn" onclick="saveF()">Save</button></div></div></div>
<div class="modal" id="alertModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">ğŸ”” Send Alert</h2><button class="modal-close" onclick="closeM('alertModal')">Ã—</button></div><div class="modal-body"><div class="form-group"><label>Student</label><select id="alertStu"></select></div><div class="tpl-section"><div class="tpl-title">âš ï¸ NEGATIVE</div><div class="tpl-grid"><button class="alert-tpl tpl-neg" onclick="setA('was absent today')"><div class="alert-icon">âŒ</div><div class="alert-label">Absent</div></button><button class="alert-tpl tpl-neg" onclick="setA('was late to class')"><div class="alert-icon">ğŸ•</div><div class="alert-label">Late</div></button><button class="alert-tpl tpl-neg" onclick="setA('showed indiscipline')"><div class="alert-icon">ğŸ˜¤</div><div class="alert-label">Indiscipline</div></button><button class="alert-tpl tpl-neg" onclick="setA('not answering in class')"><div class="alert-icon">ğŸ¤</div><div class="alert-label">Silent</div></button><button class="alert-tpl tpl-neg" onclick="setA('has pending homework')"><div class="alert-icon">ğŸ“š</div><div class="alert-label">HW Due</div></button><button class="alert-tpl tpl-neg" onclick="setA('not paying attention')"><div class="alert-icon">ğŸ˜´</div><div class="alert-label">Inattentive</div></button><button class="alert-tpl tpl-neg" onclick="setA('misbehaved in class')"><div class="alert-icon">ğŸ‘</div><div class="alert-label">Misbehave</div></button><button class="alert-tpl tpl-neg" onclick="setA('scored low in test')"><div class="alert-icon">ğŸ“‰</div><div class="alert-label">Low Score</div></button></div></div><div class="tpl-section"><div class="tpl-title">âœ… POSITIVE</div><div class="tpl-grid"><button class="alert-tpl tpl-pos" onclick="setA('performed excellently!')"><div class="alert-icon">â­</div><div class="alert-label">Excellent</div></button><button class="alert-tpl tpl-pos" onclick="setA('showing improvement')"><div class="alert-icon">ğŸ“ˆ</div><div class="alert-label">Improving</div></button><button class="alert-tpl tpl-pos" onclick="setA('had good behavior')"><div class="alert-icon">ğŸ‘</div><div class="alert-label">Good</div></button><button class="alert-tpl tpl-pos" onclick="setA('answered well')"><div class="alert-icon">ğŸ™‹</div><div class="alert-label">Active</div></button></div></div><div class="tpl-section"><div class="tpl-title">â„¹ï¸ INFO</div><div class="tpl-grid"><button class="alert-tpl tpl-warn" onclick="setA('has pending fees')"><div class="alert-icon">ğŸ’°</div><div class="alert-label">Fee Due</div></button><button class="alert-tpl tpl-info" onclick="setA('Test tomorrow')"><div class="alert-icon">ğŸ“</div><div class="alert-label">Test</div></button><button class="alert-tpl tpl-info" onclick="setA('Tomorrow is holiday')"><div class="alert-icon">ğŸ–ï¸</div><div class="alert-label">Holiday</div></button><button class="alert-tpl tpl-info" onclick="setA('PTM scheduled')"><div class="alert-icon">ğŸ‘¥</div><div class="alert-label">PTM</div></button></div></div><div class="form-group" style="margin-top:8px"><textarea id="alertMsg" rows="2" placeholder="Type message..."></textarea></div></div><div class="modal-footer"><button class="btn btn-sms" onclick="sendAlertSMS()">ğŸ“± SMS</button><button class="btn btn-wa" onclick="sendAlertWA()">ğŸ’¬ WhatsApp</button></div></div></div>
<div class="modal" id="wsModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">ğŸ“¤ Upload Worksheet</h2><button class="modal-close" onclick="closeM('wsModal')">Ã—</button></div><div class="modal-body"><div class="form-group"><label>Class</label><select id="wsClass"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>ALL</option></select></div><div class="form-group"><label>Subject</label><input type="text" id="wsSubject"></div><div class="form-group"><label>Title</label><input type="text" id="wsTitle"></div><div class="upload-box" id="uploadBox" onclick="document.getElementById('wsFile').click()"><div style="font-size:40px">ğŸ“</div><div style="color:#667eea;font-weight:600">Click to Select</div></div><div class="file-preview" id="filePreview"><span style="font-size:24px">ğŸ“„</span><span id="fileName" style="flex:1"></span><button onclick="document.getElementById('wsFile').value='';document.getElementById('filePreview').style.display='none';document.getElementById('uploadBox').style.display='block'" style="background:#ff6b6b;color:#fff;border:none;width:28px;height:28px;border-radius:8px">Ã—</button></div><input type="file" id="wsFile" style="display:none" onchange="if(this.files.length){document.getElementById('fileName').textContent=this.files[0].name;document.getElementById('filePreview').style.display='flex';document.getElementById('uploadBox').style.display='none'}"></div><div class="modal-footer"><button class="btn btn-green" onclick="saveWs()">ğŸ“¤ Upload</button></div></div></div>
<div class="toast" id="toast"></div>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyA5FjFHqFRBiGlLVe-jn7njpfXzf8hQ1cY",authDomain:"unique-study-point-2.firebaseapp.com",databaseURL:"https://unique-study-point-2-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"unique-study-point-2",storageBucket:"unique-study-point-2.appspot.com"});
var db=firebase.database(),storage=firebase.storage(),cu=null,ut='parent',stu=[],tst=[],res=[],att=[],fee=[],alerts=[],worksheets=[],ctid=null,curFilter='all',wsFilter='all',resFilter='all',pWsFilter='all',addPhotoUrl='',editPhotoUrl='',td=new Date().toISOString().split('T')[0],SMS_KEY='P3WtxzoqRgB58mSnZ1vJAwGQ2p7UTY0ci6dLjlhbkDCf4auKHI2qKczUL1AMVRj6WSDItJekFaZxP8no';
document.getElementById('tD').value=td;document.getElementById('fDate').value=td;document.getElementById('attD').value=td;document.getElementById('sJoin').value=td;
function toast(m,t){var e=document.getElementById('toast');e.textContent=m;e.className='toast show '+(t||'');setTimeout(function(){e.classList.remove('show')},3000)}
function openM(id){document.getElementById(id).classList.add('active')}
function closeM(id){document.getElementById(id).classList.remove('active')}
function logout(){cu=null;localStorage.removeItem('usp_user');location.reload()}
function setA(m){document.getElementById('alertMsg').value=m}
function sendSMS(n,m){fetch('https://www.fast2sms.com/dev/bulkV2?authorization='+SMS_KEY+'&route=q&message='+encodeURIComponent(m)+'&flash=0&numbers='+n,{method:'GET',mode:'no-cors'});toast('SMS Sent!','success')}
function formatDate(d){return d?new Date(d).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}):'N/A'}
function getMonth(){var m=['January','February','March','April','May','June','July','August','September','October','November','December'];return m[new Date().getMonth()]+' '+new Date().getFullYear()}
function upFirebase(file,cb){var ref=storage.ref('uploads/'+Date.now()+'_'+file.name);ref.put(file).then(function(snap){snap.ref.getDownloadURL().then(function(url){cb(url)})}).catch(function(e){console.log('Firebase error:',e);cb(null)})}
function upPhoto(inp,type){if(inp.files.length){toast('Uploading...','');upFirebase(inp.files[0],function(url){if(url){if(type==='add'){addPhotoUrl=url;document.getElementById('addPhotoBox').innerHTML='<img src="'+url+'">'}else{editPhotoUrl=url;document.getElementById('editPhotoBox').innerHTML='<img src="'+url+'">'}toast('Done!','success')}else{toast('Upload failed','error')}})}}
function getGrade(p){if(p>=90)return{g:'A+',c:'#27ae60',bg:'#d4fc79',r:'Outstanding performance! Keep up the excellent work.'};if(p>=80)return{g:'A',c:'#2ecc71',bg:'#a8e6cf',r:'Excellent work! Very impressive results.'};if(p>=70)return{g:'B+',c:'#3498db',bg:'#a1c4fd',r:'Very good performance! Keep improving.'};if(p>=60)return{g:'B',c:'#9b59b6',bg:'#c3aed6',r:'Good effort. Can achieve more with practice.'};if(p>=50)return{g:'C',c:'#f1c40f',bg:'#fff3b0',r:'Average performance. Needs more focus.'};if(p>=40)return{g:'D',c:'#e67e22',bg:'#ffecd2',r:'Below average. Must work harder.'};return{g:'F',c:'#e74c3c',bg:'#ffcccb',r:'Needs immediate attention and improvement.'}}
function getAlertType(msg){var neg=['absent','late','indiscipline','not answering','pending','inattentive','misbehave','low score','not paying'];var pos=['excellent','improvement','good behavior','active','answered well'];for(var i=0;i<neg.length;i++)if(msg.toLowerCase().indexOf(neg[i])>=0)return'negative';for(var i=0;i<pos.length;i++)if(msg.toLowerCase().indexOf(pos[i])>=0)return'positive';return'info'}
db.ref('.info/connected').on('value',function(s){document.getElementById('connStatus').textContent=s.val()?'âœ… Connected':'âš ï¸ Offline'});
db.ref('students').on('value',function(s){stu=[];s.forEach(function(c){stu.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('tests').on('value',function(s){tst=[];s.forEach(function(c){if(c.val()&&c.val().name)tst.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('results').on('value',function(s){res=[];s.forEach(function(c){res.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('attendance').on('value',function(s){att=[];s.forEach(function(c){att.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('fees').on('value',function(s){fee=[];s.forEach(function(c){fee.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('alerts').on('value',function(s){alerts=[];s.forEach(function(c){alerts.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('worksheets').on('value',function(s){worksheets=[];s.forEach(function(c){worksheets.push(Object.assign({id:c.key},c.val()))});render()});
var sv=localStorage.getItem('usp_user');if(sv){cu=JSON.parse(sv);if(cu.role==='admin')showAdmin();else showParent()}
function doLogin(){var u=document.getElementById('userId').value.trim(),p=document.getElementById('password').value;if(!u||!p)return toast('Enter credentials','error');if(ut==='admin'){if(u==='admin'&&p==='admin123'){cu={role:'admin'};localStorage.setItem('usp_user',JSON.stringify(cu));showAdmin()}else toast('Invalid','error')}else{var found=null;for(var i=0;i<stu.length;i++){if(stu[i].userId===u&&stu[i].password===p){found=stu[i];break}}if(found){cu={role:'parent',id:found.id,name:found.name};localStorage.setItem('usp_user',JSON.stringify(cu));showParent()}else toast('Invalid','error')}}
function showAdmin(){document.getElementById('loginPage').style.display='none';document.getElementById('adminDash').classList.add('active');initAdmin();toast('Welcome Admin!','success')}
function showParent(){document.getElementById('loginPage').style.display='none';document.getElementById('parentDash').classList.add('active');initParent();toast('Welcome!','success')}
function initParent(){document.getElementById('pNav').innerHTML='<button class="nav-item active" onclick="showP(\'pHome\')"><span>ğŸ </span><span>Home</span></button><button class="nav-item" onclick="showP(\'pResults\');renPRes()"><span>ğŸ“</span><span>Results</span></button><button class="nav-item" onclick="showP(\'pSheets\');renPWs()"><span>ğŸ“š</span><span>Materials</span></button><button class="nav-item" onclick="showP(\'pAlerts\');renPAlerts()"><span>ğŸ””</span><span>Alerts</span></button><button class="nav-item" onclick="showP(\'pFees\')"><span>ğŸ’°</span><span>Fees</span></button>';initResFilters();initPWsFilters()}
function initAdmin(){document.getElementById('aNav').innerHTML='<button class="nav-item active" onclick="showA(\'aHome\')"><span>ğŸ </span><span>Home</span></button><button class="nav-item" onclick="showA(\'aAtt\');renAtt()"><span>ğŸ“‹</span><span>Attend</span></button><button class="nav-item" onclick="showA(\'aTests\')"><span>ğŸ“</span><span>Tests</span></button><button class="nav-item" onclick="showA(\'aWorksheets\');renAWs()"><span>ğŸ“š</span><span>Sheets</span></button><button class="nav-item" onclick="showA(\'aFees\')"><span>ğŸ’°</span><span>Fees</span></button>';document.getElementById('quickActions').innerHTML='<button class="action" onclick="openM(\'addSModal\')"><div class="action-icon">â•</div><div class="action-label">Add Student</div></button><button class="action" onclick="showA(\'aAtt\');renAtt()"><div class="action-icon">ğŸ“‹</div><div class="action-label">Attendance</div></button><button class="action" onclick="openM(\'addTModal\')"><div class="action-icon">ğŸ“</div><div class="action-label">Add Test</div></button><button class="action" onclick="ldDD();openM(\'alertModal\')"><div class="action-icon">ğŸ””</div><div class="action-label">Send Alert</div></button>';document.getElementById('clsFilters').innerHTML='<button class="filter-btn active" onclick="setF(this,\'all\')">All</button><button class="filter-btn" onclick="setF(this,\'VI\')">VI</button><button class="filter-btn" onclick="setF(this,\'VII\')">VII</button><button class="filter-btn" onclick="setF(this,\'VIII\')">VIII</button><button class="filter-btn" onclick="setF(this,\'IX\')">IX</button><button class="filter-btn" onclick="setF(this,\'X\')">X</button>';document.getElementById('wsClsFilters').innerHTML='<button class="filter-btn active" onclick="setWF(this,\'all\')">All</button><button class="filter-btn" onclick="setWF(this,\'VI\')">VI</button><button class="filter-btn" onclick="setWF(this,\'VII\')">VII</button><button class="filter-btn" onclick="setWF(this,\'VIII\')">VIII</button>'}
function initResFilters(){document.getElementById('resFilters').innerHTML='<button class="filter-btn active" onclick="setResF(this,\'all\')">All</button><button class="filter-btn" onclick="setResF(this,\'5\')">Last 5</button><button class="filter-btn" onclick="setResF(this,\'10\')">Last 10</button><button class="filter-btn" onclick="setResF(this,\'Mathematics\')">Maths</button><button class="filter-btn" onclick="setResF(this,\'Science\')">Science</button><button class="filter-btn" onclick="setResF(this,\'Social Science\')">SST</button>'}
function initPWsFilters(){document.getElementById('pWsFilters').innerHTML='<button class="filter-btn active" onclick="setPWsF(this,\'all\')">All</button><button class="filter-btn" onclick="setPWsF(this,\'Mathematics\')">Maths</button><button class="filter-btn" onclick="setPWsF(this,\'Science\')">Science</button><button class="filter-btn" onclick="setPWsF(this,\'Social Science\')">SST</button>'}
function showP(id){document.querySelectorAll('#parentDash .page').forEach(function(p){p.classList.remove('active')});document.getElementById(id).classList.add('active');document.querySelectorAll('#pNav .nav-item').forEach(function(b){b.classList.remove('active')});event.target.closest('.nav-item').classList.add('active')}
function showA(id){document.querySelectorAll('#adminDash .page').forEach(function(p){p.classList.remove('active')});document.getElementById(id).classList.add('active');document.querySelectorAll('#aNav .nav-item').forEach(function(b){b.classList.remove('active')});event.target.closest('.nav-item').classList.add('active')}
function setF(btn,c){document.querySelectorAll('#clsFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');curFilter=c;renStu()}
function setWF(btn,c){document.querySelectorAll('#wsClsFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');wsFilter=c;renAWs()}
function setResF(btn,c){document.querySelectorAll('#resFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');resFilter=c;renPRes()}
function setPWsF(btn,c){document.querySelectorAll('#pWsFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');pWsFilter=c;renPWs()}
function render(){if(cu&&cu.role==='admin'){updAdmin();renStu();renTests();renFees();renAWs();ldDD()}if(cu&&cu.role==='parent'){renPHome();renPRes();renPWs();renPFees()}}
function renPHome(){if(!cu||cu.role!=='parent')return;var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;if(s.photo)document.getElementById('pPhoto').innerHTML='<img src="'+s.photo+'">';else document.getElementById('pInit').textContent=s.name?s.name.charAt(0):'S';document.getElementById('pWelcome').textContent='Welcome, '+(s.name||'');var pres=0;for(var i=0;i<att.length;i++){if(att[i].sid===cu.id&&att[i].status==='present')pres++}document.getElementById('pAttDays').textContent=pres;var myRes=[],avgPct=0;for(var i=0;i<res.length;i++){if(res[i].sid===cu.id)myRes.push(res[i])}if(myRes.length){var t=0;for(var i=0;i<myRes.length;i++){var test=null;for(var j=0;j<tst.length;j++){if(tst[j].id===myRes[i].tid){test=tst[j];break}}if(test)t+=Math.round((myRes[i].marks/test.totalMarks)*100)}avgPct=Math.round(t/myRes.length)}document.getElementById('pAvgPct').textContent=avgPct+'%';document.getElementById('pTestCnt').textContent=myRes.length;var myAlerts=[],html='';for(var i=0;i<alerts.length;i++){if(alerts[i].sid===cu.id||alerts[i].sid==='ALL')myAlerts.push(alerts[i])}myAlerts.sort(function(a,b){return(b.time||0)-(a.time||0)});myAlerts=myAlerts.slice(0,5);for(var i=0;i<myAlerts.length;i++){var type=getAlertType(myAlerts[i].msg),cls=type==='negative'?'':'positive';if(type==='info')cls='info';html+='<div class="alert-card '+cls+'"><div style="font-size:12px;font-weight:600">'+myAlerts[i].msg+'</div><div style="font-size:10px;color:#888;margin-top:4px">'+formatDate(myAlerts[i].time)+'</div></div>'}document.getElementById('notifList').innerHTML=html||'<div class="empty">No alerts</div>'}
function getFilteredResults(){var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return[];var myRes=[];for(var i=0;i<res.length;i++){if(res[i].sid===cu.id){var t=null;for(var j=0;j<tst.length;j++){if(tst[j].id===res[i].tid){t=tst[j];break}}if(t)myRes.push({marks:res[i].marks,test:t})}}myRes.sort(function(a,b){return(b.test.createdAt||0)-(a.test.createdAt||0)});if(resFilter==='5')return myRes.slice(0,5);if(resFilter==='10')return myRes.slice(0,10);if(resFilter!=='all')return myRes.filter(function(r){return r.test.subject===resFilter});return myRes}
function renPRes(){if(!cu||cu.role!=='parent')return;var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;var myRes=getFilteredResults();if(!myRes.length){document.getElementById('resultsContent').innerHTML='<div class="empty">No results found</div>';return}var totalPct=0,totalMarks=0,totalMax=0;for(var i=0;i<myRes.length;i++){totalPct+=Math.round((myRes[i].marks/myRes[i].test.totalMarks)*100);totalMarks+=myRes[i].marks;totalMax+=myRes[i].test.totalMarks}var avgPct=Math.round(totalPct/myRes.length),overall=getGrade(avgPct);var subjects={};for(var i=0;i<myRes.length;i++){var subj=myRes[i].test.subject,pct=Math.round((myRes[i].marks/myRes[i].test.totalMarks)*100);if(!subjects[subj])subjects[subj]={total:0,cnt:0,marks:0,max:0};subjects[subj].total+=pct;subjects[subj].cnt++;subjects[subj].marks+=myRes[i].marks;subjects[subj].max+=myRes[i].test.totalMarks}
var filterLabel=resFilter==='all'?'All Tests':resFilter==='5'?'Last 5 Tests':resFilter==='10'?'Last 10 Tests':resFilter+' Only';
var html='<div style="margin:0 15px"><div class="report-header"><div class="report-logo">U</div><div style="font-size:18px;font-weight:800">UNIQUE STUDY POINT</div><div style="font-size:10px;opacity:0.8">By Sumeet Sahu | Excellence in Education</div><div style="font-size:9px;opacity:0.7;margin-top:5px">Amitesh Nagar, Indore | uniquestudyonline.com</div></div>';
html+='<div style="background:#667eea;color:#fff;text-align:center;padding:8px;font-size:12px;font-weight:700">MONTHLY PROGRESS REPORT - '+getMonth().toUpperCase()+'</div>';
html+='<div class="info-grid"><div><div class="info-label">Student Name</div><div class="info-val">'+s.name+'</div></div><div><div class="info-label">Class</div><div class="info-val">'+(s.class||'-')+'</div></div><div><div class="info-label">Filter</div><div class="info-val">'+filterLabel+'</div></div><div><div class="info-label">Report Date</div><div class="info-val">'+formatDate(Date.now())+'</div></div></div>';
html+='<table class="result-table"><thead><tr><th>Test Name</th><th>Subject</th><th>Date</th><th>Marks</th><th>%</th><th>Grade</th></tr></thead><tbody>';
for(var i=0;i<myRes.length;i++){var r=myRes[i],pct=Math.round((r.marks/r.test.totalMarks)*100),g=getGrade(pct);html+='<tr><td>'+r.test.name+'</td><td>'+r.test.subject+'</td><td>'+formatDate(r.test.date)+'</td><td style="font-weight:600">'+r.marks+'/'+r.test.totalMarks+'</td><td style="font-weight:600">'+pct+'%</td><td><span class="grade-badge" style="background:'+g.bg+';color:'+g.c+'">'+g.g+'</span></td></tr>'}
html+='</tbody></table>';
html+='<div class="summary-box"><div class="summary-item"><div class="summary-val">'+myRes.length+'</div><div class="summary-lbl">Tests</div></div><div class="summary-item"><div class="summary-val">'+totalMarks+'/'+totalMax+'</div><div class="summary-lbl">Marks</div></div><div class="summary-item"><div class="summary-val">'+avgPct+'%</div><div class="summary-lbl">Average</div></div><div class="summary-item"><div class="summary-val">'+overall.g+'</div><div class="summary-lbl">Grade</div></div></div>';
var subKeys=Object.keys(subjects);if(subKeys.length>1){html+='<div style="padding:0 15px;margin-bottom:10px"><div style="font-size:12px;font-weight:700;color:#667eea;margin-bottom:8px">Subject-wise Performance:</div><div style="display:flex;gap:15px;flex-wrap:wrap">';for(var i=0;i<subKeys.length;i++){var subj=subKeys[i],avg=Math.round(subjects[subj].total/subjects[subj].cnt);html+='<div style="font-size:11px"><strong>'+subj+':</strong> '+avg+'%</div>'}html+='</div></div>'}
html+='<div class="remark-box"><div style="font-size:12px;font-weight:700;color:#667eea;margin-bottom:5px">ğŸ“ Teacher\'s Remarks:</div><div style="font-size:11px;color:#333">'+overall.r+'</div></div>';
html+='<div style="padding:15px"><button class="btn btn-dl" onclick="downloadResultPDF()">ğŸ“¥ Download Report Card</button></div>';
html+='<div style="text-align:center;padding:10px;font-size:8px;color:#888;background:#f8f9fa;border-radius:0 0 12px 12px">Grading: A+ (90-100%) A (80-89%) B+ (70-79%) B (60-69%) C (50-59%) D (40-49%) F (Below 40%)<br>This is a computer generated report from UNIQUE STUDY POINT</div></div>';
document.getElementById('resultsContent').innerHTML=html}
function downloadResultPDF(){var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;var myRes=getFilteredResults();if(!myRes.length)return toast('No results','error');var totalPct=0,totalMarks=0,totalMax=0;for(var i=0;i<myRes.length;i++){totalPct+=Math.round((myRes[i].marks/myRes[i].test.totalMarks)*100);totalMarks+=myRes[i].marks;totalMax+=myRes[i].test.totalMarks}var avgPct=Math.round(totalPct/myRes.length),overall=getGrade(avgPct);var subjects={};for(var i=0;i<myRes.length;i++){var subj=myRes[i].test.subject,pct=Math.round((myRes[i].marks/myRes[i].test.totalMarks)*100);if(!subjects[subj])subjects[subj]={total:0,cnt:0};subjects[subj].total+=pct;subjects[subj].cnt++}var filterLabel=resFilter==='all'?'All Tests':resFilter==='5'?'Last 5 Tests':resFilter==='10'?'Last 10 Tests':resFilter+' Only';var jsPDF=window.jspdf.jsPDF,doc=new jsPDF();
doc.setFillColor(26,26,46);doc.rect(0,0,210,50,'F');doc.setFillColor(102,126,234);doc.rect(0,50,210,12,'F');
doc.setTextColor(255);doc.setFontSize(10);doc.text('U',20,20);doc.setFillColor(102,126,234);doc.roundedRect(15,10,15,15,3,3,'F');doc.setTextColor(255);doc.setFontSize(12);doc.setFont('helvetica','bold');doc.text('U',20,20);
doc.setFontSize(22);doc.text('UNIQUE STUDY POINT',105,22,{align:'center'});doc.setFontSize(10);doc.setFont('helvetica','normal');doc.text('By Sumeet Sahu | Excellence in Education',105,30,{align:'center'});doc.setFontSize(8);doc.text('Amitesh Nagar, Indore, M.P. | uniquestudyonline.com | Timing: 4:30 PM - 9:00 PM',105,40,{align:'center'});
doc.setFontSize(11);doc.setFont('helvetica','bold');doc.text('MONTHLY PROGRESS REPORT - '+getMonth().toUpperCase(),105,58,{align:'center'});
doc.setTextColor(60);doc.setFontSize(10);var y=70;doc.setFont('helvetica','normal');doc.text('Student Name:',20,y);doc.setFont('helvetica','bold');doc.text(s.name,55,y);doc.setFont('helvetica','normal');doc.text('Class:',120,y);doc.setFont('helvetica','bold');doc.text(s.class||'-',140,y);y+=8;doc.setFont('helvetica','normal');doc.text('Filter:',20,y);doc.setFont('helvetica','bold');doc.text(filterLabel,55,y);doc.setFont('helvetica','normal');doc.text('Report Date:',120,y);doc.setFont('helvetica','bold');doc.text(formatDate(Date.now()),155,y);
var tableData=[];for(var i=0;i<myRes.length;i++){var r=myRes[i],pct=Math.round((r.marks/r.test.totalMarks)*100),g=getGrade(pct);tableData.push([r.test.name,r.test.subject,formatDate(r.test.date),r.marks+'/'+r.test.totalMarks,pct+'%',g.g])}
doc.autoTable({startY:85,head:[['Test Name','Subject','Date','Marks','Percentage','Grade']],body:tableData,theme:'striped',headStyles:{fillColor:[102,126,234],fontSize:9,fontStyle:'bold'},bodyStyles:{fontSize:9},columnStyles:{3:{halign:'center'},4:{halign:'center'},5:{halign:'center'}}});
y=doc.lastAutoTable.finalY+10;doc.setFillColor(102,126,234);doc.roundedRect(15,y,180,25,3,3,'F');doc.setTextColor(255);doc.setFontSize(10);doc.setFont('helvetica','bold');var sx=35;doc.text('Tests: '+myRes.length,sx,y+10);doc.text('Marks: '+totalMarks+'/'+totalMax,sx+45,y+10);doc.text('Average: '+avgPct+'%',sx+100,y+10);doc.text('Grade: '+overall.g,sx+145,y+10);doc.setFontSize(8);doc.setFont('helvetica','normal');doc.text('PERFORMANCE SUMMARY',105,y+20,{align:'center'});
y+=35;var subKeys=Object.keys(subjects);if(subKeys.length>1){doc.setTextColor(60);doc.setFontSize(10);doc.setFont('helvetica','bold');doc.text('Subject-wise Performance:',20,y);y+=7;doc.setFont('helvetica','normal');var subText='';for(var i=0;i<subKeys.length;i++){var avg=Math.round(subjects[subKeys[i]].total/subjects[subKeys[i]].cnt);subText+=subKeys[i]+': '+avg+'%   '}doc.text(subText,20,y);y+=10}
doc.setFillColor(240,248,255);doc.roundedRect(15,y,180,20,2,2,'F');doc.setDrawColor(102,126,234);doc.setLineWidth(0.5);doc.line(15,y,15,y+20);doc.setTextColor(102,126,234);doc.setFontSize(10);doc.setFont('helvetica','bold');doc.text("Teacher's Remarks:",20,y+7);doc.setTextColor(60);doc.setFont('helvetica','normal');doc.setFontSize(9);doc.text(overall.r,20,y+15);
doc.setFillColor(50,50,70);doc.rect(0,277,210,20,'F');doc.setTextColor(200);doc.setFontSize(7);doc.text('Grading Scale: A+ (90-100%) A (80-89%) B+ (70-79%) B (60-69%) C (50-59%) D (40-49%) F (Below 40%)',105,283,{align:'center'});doc.text('This is a computer generated report from UNIQUE STUDY POINT Student Management System',105,289,{align:'center'});doc.text('For queries: uniquestudyonline.com | Contact during working hours',105,294,{align:'center'});
doc.save(s.name+'_Report_'+getMonth().replace(' ','_')+'.pdf');toast('Downloaded!','success')}
function renPWs(){if(!cu||cu.role!=='parent')return;var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;var myWs=worksheets.filter(function(w){return w.class===s.class||w.class==='ALL'});if(pWsFilter!=='all')myWs=myWs.filter(function(w){return w.subject===pWsFilter});myWs.sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0)});var html='';for(var i=0;i<myWs.length;i++){var w=myWs[i];html+='<div class="ws-card"><div style="font-weight:700;font-size:14px;margin-bottom:4px">'+w.title+'</div><div style="font-size:11px;color:#888;margin-bottom:10px">ğŸ“– '+w.subject+' â€¢ '+formatDate(w.createdAt)+'</div><a href="'+w.url+'" target="_blank" class="btn btn-dl" style="text-decoration:none;display:block;text-align:center">ğŸ“¥ Download</a></div>'}document.getElementById('pWsList').innerHTML=html||'<div class="empty">No worksheets available</div>'}
function renPAlerts(){if(!cu||cu.role!=='parent')return;var myAlerts=[];for(var i=0;i<alerts.length;i++){if(alerts[i].sid===cu.id||alerts[i].sid==='ALL')myAlerts.push(alerts[i])}myAlerts.sort(function(a,b){return(b.time||0)-(a.time||0)});var neg=0,pos=0,info=0;for(var i=0;i<myAlerts.length;i++){var type=getAlertType(myAlerts[i].msg);if(type==='negative')neg++;else if(type==='positive')pos++;else info++}var html='<div style="padding:0 20px"><div style="background:#fff;border-radius:16px;padding:15px;margin-bottom:15px"><h4 style="color:#667eea;margin-bottom:10px;font-size:13px">ğŸ“Š Alert Summary</h4><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;text-align:center"><div style="background:#ffecd2;padding:12px;border-radius:10px"><div style="font-size:20px;font-weight:800;color:#e74c3c">'+neg+'</div><div style="font-size:9px;color:#888">Negative</div></div><div style="background:#d4fc79;padding:12px;border-radius:10px"><div style="font-size:20px;font-weight:800;color:#27ae60">'+pos+'</div><div style="font-size:9px;color:#888">Positive</div></div><div style="background:#a1c4fd;padding:12px;border-radius:10px"><div style="font-size:20px;font-weight:800;color:#667eea">'+info+'</div><div style="font-size:9px;color:#888">Info</div></div></div></div></div>';for(var i=0;i<myAlerts.length;i++){var a=myAlerts[i],type=getAlertType(a.msg),cls=type==='negative'?'':'positive';if(type==='info')cls='info';var icon=type==='negative'?'âš ï¸':type==='positive'?'âœ…':'â„¹ï¸';html+='<div class="alert-card '+cls+'" style="margin:0 20px 8px"><div style="display:flex;gap:10px;align-items:center"><span style="font-size:20px">'+icon+'</span><div style="flex:1"><div style="font-size:12px;font-weight:600">'+a.msg+'</div><div style="font-size:10px;color:#888;margin-top:2px">'+formatDate(a.time)+'</div></div></div></div>'}document.getElementById('alertHistoryList').innerHTML=html||'<div class="empty">No alerts</div>'}
function downloadAlertPDF(){var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;var myAlerts=[];for(var i=0;i<alerts.length;i++){if(alerts[i].sid===cu.id||alerts[i].sid==='ALL')myAlerts.push(alerts[i])}myAlerts.sort(function(a,b){return(b.time||0)-(a.time||0)});if(!myAlerts.length)return toast('No alerts','error');var jsPDF=window.jspdf.jsPDF,doc=new jsPDF();doc.setFillColor(102,126,234);doc.rect(0,0,210,45,'F');doc.setTextColor(255);doc.setFontSize(22);doc.text('UNIQUE STUDY POINT',105,18,{align:'center'});doc.setFontSize(10);doc.text('Student Alert Report',105,28,{align:'center'});doc.text(s.name+' | Class '+(s.class||''),105,38,{align:'center'});var tableData=[];for(var i=0;i<myAlerts.length;i++){var a=myAlerts[i],type=getAlertType(a.msg);tableData.push([i+1,formatDate(a.time),a.msg,type])}doc.autoTable({startY:55,head:[['#','Date','Message','Type']],body:tableData,theme:'striped',headStyles:{fillColor:[102,126,234]},columnStyles:{2:{cellWidth:100}}});doc.setFillColor(50,50,70);doc.rect(0,280,210,17,'F');doc.setTextColor(255);doc.setFontSize(8);doc.text('UNIQUE STUDY POINT | Amitesh Nagar, Indore',105,288,{align:'center'});doc.save(s.name+'_Alerts.pdf');toast('Downloaded!','success')}
function renPFees(){if(!cu||cu.role!=='parent')return;var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===cu.id){s=stu[i];break}}if(!s)return;var myFee=[],paid=0;for(var i=0;i<fee.length;i++){if(fee[i].sid===cu.id){myFee.push(fee[i]);paid+=fee[i].amount}}var join=new Date(s.joinDate||td),now=new Date(),months=Math.max(1,(now.getFullYear()-join.getFullYear())*12+(now.getMonth()-join.getMonth())+1);var due=(s.fee||500)*months,pending=Math.max(0,due-paid);document.getElementById('feePend').textContent='â‚¹'+pending;document.getElementById('feeStat').textContent=pending>0?'âš ï¸ Due':'âœ… Clear';myFee.sort(function(a,b){return new Date(b.date)-new Date(a.date)});var html='';for(var i=0;i<myFee.length;i++){html+='<div class="card"><div class="avatar" style="background:#d4fc79;color:#333">ğŸ’°</div><div class="card-info"><div class="card-title">â‚¹'+myFee[i].amount+'</div><div class="card-sub">'+formatDate(myFee[i].date)+'</div></div></div>'}document.getElementById('feeList').innerHTML=html||'<div class="empty">No payments</div>'}
function renAWs(){var f=wsFilter==='all'?worksheets:worksheets.filter(function(w){return w.class===wsFilter});f.sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0)});var html='';for(var i=0;i<f.length;i++){var w=f[i];html+='<div class="ws-card"><div style="font-weight:700;font-size:14px;margin-bottom:4px">'+w.title+'</div><div style="font-size:11px;color:#888;margin-bottom:10px">ğŸ“– '+w.subject+' â€¢ '+w.class+' â€¢ '+formatDate(w.createdAt)+'</div><div style="display:flex;gap:8px"><a href="'+w.url+'" target="_blank" class="btn-small" style="background:#667eea;text-decoration:none">ğŸ“¥</a><button class="btn-small btn-del" onclick="delWs(\''+w.id+'\')">ğŸ—‘ï¸</button></div></div>'}document.getElementById('aWsList').innerHTML=html||'<div class="empty">No worksheets</div>'}
function delWs(id){if(confirm('Delete?')){db.ref('worksheets/'+id).remove();toast('Deleted!','success')}}
function renFees(){var sorted=fee.slice().sort(function(a,b){return new Date(b.date)-new Date(a.date)});var html='';for(var i=0;i<sorted.length;i++){var f=sorted[i],s=null;for(var j=0;j<stu.length;j++){if(stu[j].id===f.sid){s=stu[j];break}}if(s)html+='<div class="card"><div class="avatar">ğŸ’°</div><div class="card-info"><div class="card-title">'+s.name+'</div><div class="card-sub">â‚¹'+f.amount+' â€¢ '+formatDate(f.date)+'</div></div></div>'}document.getElementById('feeL').innerHTML=html||'<div class="empty">No payments</div>'}
function ldDD(){var opts='<option value="">Select</option><option value="ALL">ğŸ“¢ ALL STUDENTS</option>';for(var i=0;i<stu.length;i++){opts+='<option value="'+stu[i].id+'">'+stu[i].name+' ('+stu[i].class+')</option>'}document.getElementById('alertStu').innerHTML=opts;var fOpts='<option value="">Select</option>';for(var i=0;i<stu.length;i++){fOpts+='<option value="'+stu[i].id+'">'+stu[i].name+'</option>'}document.getElementById('fStu').innerHTML=fOpts}
function saveF(){var sid=document.getElementById('fStu').value,amt=document.getElementById('fAmt').value,d=document.getElementById('fDate').value;if(!sid||!amt)return toast('Fill all','error');db.ref('fees').push({sid:sid,amount:parseInt(amt),date:d}).then(function(){closeM('addFModal');document.getElementById('fAmt').value='';toast('Saved!','success')})}
function sendAlertSMS(){var sid=document.getElementById('alertStu').value,msg=document.getElementById('alertMsg').value.trim();if(!sid)return toast('Select student','error');if(!msg)return toast('Enter message','error');if(sid==='ALL'){sendSMS(stu.map(function(s){return s.mobile}).join(','),'UNIQUE STUDY POINT: '+msg+' -Sumeet Sahu');db.ref('alerts').push({sid:'ALL',msg:msg,time:Date.now()})}else{var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===sid){s=stu[i];break}}if(s){sendSMS(s.mobile,'UNIQUE STUDY POINT: '+s.name+' '+msg+' -Sumeet Sahu');db.ref('alerts').push({sid:sid,msg:s.name+' '+msg,time:Date.now()})}}closeM('alertModal');document.getElementById('alertMsg').value='';toast('Alert sent!','success')}
function sendAlertWA(){var sid=document.getElementById('alertStu').value,msg=document.getElementById('alertMsg').value.trim();if(!sid)return toast('Select student','error');if(!msg)return toast('Enter message','error');if(sid==='ALL'){var idx=0;for(var i=0;i<stu.length;i++){(function(delay,s){setTimeout(function(){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n\n'+msg+'\n\n-Sumeet Sahu'),'_blank')},delay*1500)})(idx,stu[i]);idx++}db.ref('alerts').push({sid:'ALL',msg:msg,time:Date.now()})}else{var s=null;for(var i=0;i<stu.length;i++){if(stu[i].id===sid){s=stu[i];break}}if(s){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n\n'+s.name+' '+msg+'\n\n-Sumeet Sahu'),'_blank');db.ref('alerts').push({sid:sid,msg:s.name+' '+msg,time:Date.now()})}}closeM('alertModal');document.getElementById('alertMsg').value='';toast('Opening WA...','success')}
function saveWs(){var cls=document.getElementById('wsClass').value,subj=document.getElementById('wsSubject').value.trim(),title=document.getElementById('wsTitle').value.trim(),fileInput=document.getElementById('wsFile');if(!cls||!subj||!title)return toast('Fill all','error');if(!fileInput.files.length)return toast('Select file','error');toast('Uploading...','');upFirebase(fileInput.files[0],function(url){if(url){db.ref('worksheets').push({class:cls,subject:subj,title:title,url:url,createdAt:Date.now()}).then(function(){closeM('wsModal');document.getElementById('wsClass').value='';document.getElementById('wsSubject').value='';document.getElementById('wsTitle').value='';document.getElementById('wsFile').value='';document.getElementById('filePreview').style.display='none';document.getElementById('uploadBox').style.display='block';toast('Uploaded!','success')})}else{toast('Upload failed!','error')}})}
</script>
</body>
</html>
