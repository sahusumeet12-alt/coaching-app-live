<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UNIQUE STUDY POINT</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:#f0f2f5;min-height:100vh}
.container{max-width:500px;margin:0 auto}
.login-page{min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;align-items:center;padding:40px 20px}
.logo{width:100px;height:100px;background:linear-gradient(135deg,#ff9a56,#ff6b6b);border-radius:25px;display:flex;align-items:center;justify-content:center;margin-bottom:20px;box-shadow:0 15px 35px rgba(0,0,0,0.3)}
.logo span{font-size:36px;font-weight:800;color:#fff}
.brand{text-align:center;color:#fff;margin-bottom:25px}
.brand h1{font-size:22px}
.brand a{color:#ffd700;text-decoration:none}
.login-card{background:#fff;border-radius:28px;padding:30px;width:100%}
.tabs{display:flex;gap:12px;margin-bottom:20px}
.tab-btn{flex:1;padding:15px;border:none;border-radius:16px;background:#f0f2f5;cursor:pointer;font-family:inherit}
.tab-btn.active{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
.tab-btn .icon{font-size:24px;display:block;margin-bottom:4px}
.tab-btn .label{font-size:13px;font-weight:700}
.status{text-align:center;padding:10px;border-radius:12px;margin-bottom:18px;font-size:12px;font-weight:600;background:#d4fc79;color:#2d5a3d}
.form-group{margin-bottom:18px}
.form-group label{display:block;font-size:12px;font-weight:700;color:#667eea;margin-bottom:6px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:14px;border:2px solid #e8e8e8;border-radius:14px;font-size:15px;font-family:inherit}
.btn{width:100%;padding:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer}
.btn:active{transform:scale(0.98)}
.btn-sms{background:linear-gradient(135deg,#ff6b6b,#ee5a5a)}
.btn-wa{background:linear-gradient(135deg,#25D366,#128C7E)}
.btn-dl{background:linear-gradient(135deg,#f093fb,#f5576c)}
.btn-green{background:linear-gradient(135deg,#11998e,#38ef7d)}
.btn-small{padding:10px 16px;font-size:12px;width:auto;border-radius:10px;border:none;cursor:pointer;font-weight:600;color:#fff}
.btn-del{background:linear-gradient(135deg,#ff6b6b,#ee5a5a);color:#fff}
.dashboard{display:none}
.dashboard.active{display:block}
.header{background:linear-gradient(135deg,#667eea,#764ba2);padding:25px 20px;color:#fff;text-align:center;position:relative}
.header h1{font-size:20px}
.logout-btn{position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);border:none;color:#fff;padding:8px 14px;border-radius:10px;cursor:pointer}
.profile-pic{width:80px;height:80px;border-radius:50%;border:3px solid #fff;margin:0 auto 12px;background:#ff9a56;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:800;color:#fff;overflow:hidden}
.profile-pic img{width:100%;height:100%;object-fit:cover}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;padding:15px 20px}
.stat{background:#fff;padding:15px;border-radius:16px;text-align:center}
.stat-val{font-size:20px;font-weight:800;color:#667eea}
.stat-lbl{font-size:9px;color:#888;font-weight:600}
.section{padding:0 20px}
.section-title{font-size:15px;font-weight:700;color:#667eea;margin:18px 0 12px}
.actions{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.action{background:#fff;border:none;padding:20px;border-radius:16px;text-align:center;cursor:pointer;font-family:inherit}
.action-icon{font-size:28px;margin-bottom:6px}
.action-label{font-size:11px;font-weight:700}
.list{padding:0 20px}
.card{background:#fff;border-radius:16px;padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px}
.avatar{width:46px;height:46px;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:12px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;flex-shrink:0;overflow:hidden}
.avatar img{width:100%;height:100%;object-fit:cover}
.card-info{flex:1;min-width:0}
.card-title{font-weight:600;color:#333;font-size:13px}
.card-sub{font-size:10px;color:#888}
.nav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:500px;background:#fff;padding:10px;display:flex;justify-content:space-around;box-shadow:0 -8px 30px rgba(0,0,0,0.1);border-radius:22px 22px 0 0;z-index:100}
.nav-item{display:flex;flex-direction:column;align-items:center;background:transparent;border:none;cursor:pointer;padding:6px 10px;border-radius:12px;font-family:inherit}
.nav-item.active{background:rgba(102,126,234,0.15)}
.nav-item span:first-child{font-size:20px}
.nav-item span:last-child{font-size:8px;font-weight:700;color:#888}
.nav-item.active span:last-child{color:#667eea}
.page{display:none;padding-bottom:85px}
.page.active{display:block}
.filter-row{display:flex;gap:8px;padding:0 20px;margin-bottom:12px;flex-wrap:wrap}
.filter-btn{padding:8px 14px;border:2px solid #e8e8e8;border-radius:25px;background:#fff;font-size:11px;font-weight:600;cursor:pointer}
.filter-btn.active{border-color:#667eea;background:#667eea;color:#fff}
.result-card{background:#fff;border-radius:18px;padding:16px;margin:0 20px 12px;display:flex;align-items:center;gap:12px}
.score-circle{width:55px;height:55px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:800;color:#fff}
.chart-box{background:#fff;margin:15px 20px;padding:18px;border-radius:18px}
.chart-box h3{font-size:15px;font-weight:700;color:#667eea;margin-bottom:12px}
.chart-wrap{height:200px}
.fee-card{background:linear-gradient(135deg,#667eea,#764ba2);margin:0 20px 15px;padding:22px;border-radius:18px;color:#fff}
.fee-amt{font-size:32px;font-weight:800}
.fee-status{display:inline-block;padding:5px 12px;background:rgba(255,255,255,0.2);border-radius:15px;font-size:11px;margin-top:8px}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:1000;padding:15px}
.modal.active{display:flex}
.modal-content{background:#fff;border-radius:22px;width:100%;max-width:420px;max-height:85vh;overflow-y:auto}
.modal-header{padding:18px;border-bottom:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:16px;font-weight:700;color:#667eea}
.modal-close{background:#ff6b6b;border:none;color:#fff;width:32px;height:32px;border-radius:8px;cursor:pointer;font-size:16px}
.modal-body{padding:18px}
.modal-footer{padding:12px 18px 18px;display:flex;gap:8px;flex-wrap:wrap}
.modal-footer .btn{flex:1;padding:12px;min-width:45%}
.toast{position:fixed;top:15px;left:50%;transform:translateX(-50%) translateY(-100px);background:#667eea;color:#fff;padding:12px 22px;border-radius:12px;font-size:13px;font-weight:600;z-index:2000;transition:transform .3s}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.success{background:#25D366}
.toast.error{background:#ff6b6b}
.empty{text-align:center;padding:40px;color:#888}
.tpl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.alert-tpl{padding:12px 8px;border:none;border-radius:12px;cursor:pointer;text-align:center;font-family:inherit}
.alert-tpl .alert-icon{font-size:20px;margin-bottom:4px}
.alert-tpl .alert-label{font-size:9px;font-weight:600;color:#333}
.tpl-neg{background:linear-gradient(135deg,#ffecd2,#fcb69f)}
.tpl-pos{background:linear-gradient(135deg,#d4fc79,#96e6a1)}
.tpl-info{background:linear-gradient(135deg,#a1c4fd,#c2e9fb)}
.tpl-warn{background:linear-gradient(135deg,#fff3b0,#ffd93d)}
.test-card,.ws-card{background:#fff;border-radius:16px;padding:16px;margin-bottom:12px;border-left:4px solid #667eea}
.upload-box{background:linear-gradient(135deg,#667eea15,#764ba215);border:2px dashed #667eea;border-radius:16px;padding:30px;text-align:center;cursor:pointer;margin-bottom:15px}
.file-preview{background:#f0f2f5;border-radius:12px;padding:12px;margin-bottom:15px;display:none;align-items:center;gap:10px}
.photo-upload{width:80px;height:80px;border-radius:50%;border:3px dashed #667eea;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;background:#f0f2f5}
.photo-upload img{width:100%;height:100%;object-fit:cover}
.att-detail{background:#fff;border-radius:16px;padding:16px;margin:0 20px 12px}
.att-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f0f0f0;font-size:12px}
.report-view{position:fixed;top:0;left:0;right:0;bottom:0;background:#fff;z-index:2000;overflow-y:auto;display:none}
.report-view.active{display:block}
.report-header{background:linear-gradient(135deg,#667eea,#764ba2);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;color:#fff;position:sticky;top:0}
.chart-container{background:#fff;border-radius:16px;padding:15px;margin-bottom:15px}
.subject-row{display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f8f9fa;border-radius:10px;margin-bottom:8px}
.remark-box{background:linear-gradient(135deg,#667eea15,#764ba215);border-radius:12px;padding:15px;margin-top:15px;font-size:12px}
</style>
</head>
<body>
<div class="container">
<div class="login-page" id="loginPage">
<div class="logo"><span>USP</span></div>
<div class="brand"><h1>‚ú® UNIQUE STUDY POINT</h1><p>By Sumeet Sahu</p><p style="margin-top:8px"><a href="https://www.uniquestudyonline.com" target="_blank">üåê www.uniquestudyonline.com</a></p></div>
<div class="login-card">
<div class="tabs">
<button class="tab-btn active" id="parentTab" onclick="ut='parent';this.classList.add('active');document.getElementById('adminTab').classList.remove('active')"><span class="icon">üë®‚Äçüë©‚Äçüëß</span><span class="label">Parent</span></button>
<button class="tab-btn" id="adminTab" onclick="ut='admin';this.classList.add('active');document.getElementById('parentTab').classList.remove('active')"><span class="icon">üë®‚Äçüíº</span><span class="label">Admin</span></button>
</div>
<div class="status" id="connStatus">‚óè Connecting...</div>
<div class="form-group"><label>USER ID</label><input type="text" id="userId" placeholder="Enter User ID"></div>
<div class="form-group"><label>PASSWORD</label><input type="password" id="password" placeholder="Enter Password"></div>
<button class="btn" id="loginBtn">üöÄ Login</button>
</div>
</div>
<div class="dashboard" id="parentDash">
<div class="page active" id="pHome"><div class="header"><button class="logout-btn" onclick="logout()">üö™</button><div class="profile-pic" id="pPhoto"><span id="pInit">S</span></div><h1 id="pWelcome">Welcome</h1><p>UNIQUE STUDY POINT</p></div><div class="stats"><div class="stat"><div class="stat-val" id="pAttDays">0</div><div class="stat-lbl">DAYS PRESENT</div></div><div class="stat"><div class="stat-val" id="pAvgPct">0%</div><div class="stat-lbl">AVG SCORE</div></div><div class="stat"><div class="stat-val" id="pTestCnt">0</div><div class="stat-lbl">TESTS</div></div></div><div class="section"><h3 class="section-title">üîî Notifications</h3></div><div class="list" id="notifList"></div></div>
<div class="page" id="pResults"><div class="header"><h1>üìù Results</h1></div><div class="filter-row" id="resFilters" style="margin-top:15px"></div><div id="resultsList"></div><div style="padding:15px 20px"><button class="btn btn-green" onclick="viewReport()">üëÅÔ∏è View Report</button></div></div>
<div class="page" id="pProgress"><div class="header"><h1>üìä Progress</h1></div><div class="chart-box"><h3>üìà Performance Trend</h3><div class="chart-wrap"><canvas id="lineChart"></canvas></div></div><div class="chart-box"><h3>üìä Subject Analysis</h3><div class="chart-wrap"><canvas id="pieChart"></canvas></div></div></div>
<div class="page" id="pAttendance"><div class="header"><h1>üìã Attendance</h1></div><div class="stats" style="margin-top:0"><div class="stat"><div class="stat-val" id="pTotalDays">0</div><div class="stat-lbl">TOTAL</div></div><div class="stat"><div class="stat-val" id="pPresentDays">0</div><div class="stat-lbl">PRESENT</div></div><div class="stat"><div class="stat-val" id="pAttPercent">0%</div><div class="stat-lbl">PERCENTAGE</div></div></div><div style="padding:15px 20px"><button class="btn btn-dl" onclick="downloadAttPDF()">üì• Download Attendance PDF</button></div><div id="attMonthList"></div></div>
<div class="page" id="pFees"><div class="header"><h1>üí∞ Fees</h1></div><div class="fee-card"><div style="font-size:12px;opacity:0.9">Pending Amount</div><div class="fee-amt" id="feePend">‚Çπ0</div><div class="fee-status" id="feeStat">Clear</div></div><div class="section"><h3 class="section-title">üí≥ Payment History</h3></div><div class="list" id="feeList"></div></div>
<div class="nav" id="pNav"></div>
</div>
<div class="dashboard" id="adminDash">
<div class="page active" id="aHome"><div class="header" style="padding-bottom:50px"><button class="logout-btn" onclick="logout()">üö™</button><p>Admin Panel</p><h1>Sumeet Sahu</h1></div><div class="stats" style="margin-top:-30px"><div class="stat"><div class="stat-val" id="aStu">0</div><div class="stat-lbl">STUDENTS</div></div><div class="stat"><div class="stat-val" id="aPre">0</div><div class="stat-lbl">PRESENT</div></div><div class="stat"><div class="stat-val" id="aTst">0</div><div class="stat-lbl">TESTS</div></div></div><div class="section"><h3 class="section-title">‚ö° Quick Actions</h3><div class="actions" id="quickActions"></div><h3 class="section-title">üë®‚Äçüéì Students</h3></div><div class="filter-row" id="clsFilters"></div><div class="list" id="aList"></div></div>
<div class="page" id="aAtt"><div class="header"><h1>üìã Attendance</h1></div><div class="section" style="padding-top:15px"><div class="form-group"><label>Date</label><input type="date" id="attD" onchange="renAtt()"></div><div class="form-group"><label>Month (PDF)</label><input type="month" id="attMonth"></div><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn btn-sms" onclick="sendAttSMS()" style="flex:1">üì±</button><button class="btn btn-wa" onclick="sendAttWA()" style="flex:1">üí¨</button><button class="btn btn-dl" onclick="downloadAdminAttPDF()" style="flex:1">üì•</button></div></div><div class="list" id="attL" style="margin-top:12px"></div></div>
<div class="page" id="aTests"><div class="header"><h1>üìù Tests</h1></div><div class="section" style="padding-top:15px"><button class="btn" onclick="openM('addTModal')">‚ûï Create New Test</button></div><div class="list" id="testL" style="margin-top:12px"></div></div>
<div class="page" id="aWorksheets"><div class="header"><h1>üìö Worksheets</h1></div><div class="section" style="padding-top:15px"><button class="btn btn-green" onclick="openM('wsModal')">üì§ Upload Worksheet</button></div><div class="filter-row" id="wsClsFilters" style="margin-top:15px"></div><div class="list" id="aWsList" style="margin-top:12px"></div></div>
<div class="page" id="aFees"><div class="header"><h1>üí∞ Fees</h1></div><div class="section" style="padding-top:15px"><button class="btn" onclick="ldDD();openM('addFModal')">üí∞ Record Payment</button></div><div class="list" id="feeL" style="margin-top:12px"></div></div>
<div class="nav" id="aNav"></div>
</div>
</div>
<div class="report-view" id="reportView"><div class="report-header"><button onclick="closeReport()" style="background:rgba(255,255,255,0.2);border:none;color:#fff;padding:10px 15px;border-radius:10px;cursor:pointer">‚Üê Back</button><h3>Progress Report</h3><button onclick="downloadReport()" style="background:#25D366;border:none;color:#fff;padding:10px 15px;border-radius:10px;cursor:pointer">üì•</button></div><div class="report-content" id="reportContent"></div></div>
<div class="modal" id="addSModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">‚ûï Add Student</h2><button class="modal-close" onclick="closeM('addSModal')">√ó</button></div><div class="modal-body">
<div class="photo-upload" id="addPhotoBox" onclick="document.getElementById('addPhotoInput').click()"><span style="font-size:28px">üì∑</span></div><input type="file" id="addPhotoInput" accept="image/*" style="display:none" onchange="uploadPhoto(this,'add')">
<div class="form-group"><label>Full Name *</label><input type="text" id="sN"></div>
<div class="form-group"><label>Class *</label><select id="sC"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>XI</option><option>XII</option></select></div>
<div class="form-group"><label>Mobile *</label><input type="tel" id="sM" maxlength="10"></div>
<div class="form-group"><label>User ID *</label><input type="text" id="sU"></div>
<div class="form-group"><label>Password *</label><input type="text" id="sP"></div>
<div class="form-group"><label>Monthly Fee (‚Çπ)</label><input type="number" id="sFee" value="500"></div>
<div class="form-group"><label>Joining Date</label><input type="date" id="sJoin"></div>
</div><div class="modal-footer"><button class="btn" onclick="saveStudent()">Add Student</button></div></div></div>
<div class="modal" id="editSModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">‚úèÔ∏è Edit Student</h2><button class="modal-close" onclick="closeM('editSModal')">√ó</button></div><div class="modal-body">
<div class="photo-upload" id="editPhotoBox" onclick="document.getElementById('editPhotoInput').click()"><span style="font-size:28px">üì∑</span></div><input type="file" id="editPhotoInput" accept="image/*" style="display:none" onchange="uploadPhoto(this,'edit')"><input type="hidden" id="editSId">
<div class="form-group"><label>Full Name *</label><input type="text" id="editSN"></div>
<div class="form-group"><label>Class *</label><select id="editSC"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>XI</option><option>XII</option></select></div>
<div class="form-group"><label>Mobile *</label><input type="tel" id="editSM" maxlength="10"></div>
<div class="form-group"><label>User ID *</label><input type="text" id="editSU"></div>
<div class="form-group"><label>Password *</label><input type="text" id="editSP"></div>
<div class="form-group"><label>Monthly Fee (‚Çπ)</label><input type="number" id="editSFee"></div>
<div class="form-group"><label>Joining Date</label><input type="date" id="editSJoin"></div>
</div><div class="modal-footer"><button class="btn btn-green" onclick="updateStudent()">üíæ Update</button><button class="btn btn-del" onclick="deleteStudent()">üóëÔ∏è Delete</button></div></div></div>
<div class="modal" id="addTModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">üìù Create Test</h2><button class="modal-close" onclick="closeM('addTModal')">√ó</button></div><div class="modal-body">
<div class="form-group"><label>Test Name *</label><input type="text" id="tN"></div>
<div class="form-group"><label>Subject *</label><select id="tSubjSel" onchange="document.getElementById('otherSubjGroup').style.display=this.value==='other'?'block':'none'"><option value="">Select</option><option value="Mathematics">Mathematics</option><option value="Science">Science</option><option value="Social Science">Social Science</option><option value="Hindi">Hindi</option><option value="English">English</option><option value="GK">GK</option><option value="other">Other</option></select></div>
<div class="form-group" id="otherSubjGroup" style="display:none"><label>Enter Subject</label><input type="text" id="tSOther"></div>
<div class="form-group"><label>Total Marks</label><input type="number" id="tM" value="100"></div>
<div class="form-group"><label>Test Date</label><input type="date" id="tD"></div>
<div class="form-group"><label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="tNotify" style="width:auto"> Notify all parents</label></div>
</div><div class="modal-footer"><button class="btn" onclick="saveTest()">Create Test</button></div></div></div>
<div class="modal" id="editTModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">‚úèÔ∏è Edit Test</h2><button class="modal-close" onclick="closeM('editTModal')">√ó</button></div><div class="modal-body"><input type="hidden" id="editTId">
<div class="form-group"><label>Test Name</label><input type="text" id="editTN"></div>
<div class="form-group"><label>Subject</label><input type="text" id="editTS"></div>
<div class="form-group"><label>Total Marks</label><input type="number" id="editTM"></div>
<div class="form-group"><label>Date</label><input type="date" id="editTD"></div>
</div><div class="modal-footer"><button class="btn btn-green" onclick="updateTest()">üíæ Update</button><button class="btn btn-del" onclick="deleteTest()">üóëÔ∏è Delete</button></div></div></div>
<div class="modal" id="addMkModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">üìù <span id="mkTN"></span></h2><button class="modal-close" onclick="closeM('addMkModal')">√ó</button></div><div class="modal-body"><div id="mkL"></div></div><div class="modal-footer"><button class="btn" onclick="saveMk()">üíæ Save</button><button class="btn btn-sms" onclick="saveMk();setTimeout(sendMkSMS,500)">üì± SMS</button><button class="btn btn-wa" onclick="saveMk();setTimeout(sendMkWA,500)">üí¨ WA</button></div></div></div>
<div class="modal" id="addFModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">üí∞ Record Fee</h2><button class="modal-close" onclick="closeM('addFModal')">√ó</button></div><div class="modal-body">
<div class="form-group"><label>Student</label><select id="fStu"></select></div>
<div class="form-group"><label>Amount (‚Çπ)</label><input type="number" id="fAmt"></div>
<div class="form-group"><label>Date</label><input type="date" id="fDate"></div>
</div><div class="modal-footer"><button class="btn" onclick="saveFee()">Save</button></div></div></div>
<div class="modal" id="alertModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">üîî Send Alert</h2><button class="modal-close" onclick="closeM('alertModal')">√ó</button></div><div class="modal-body">
<div class="form-group"><label>Student</label><select id="alertStu"></select></div>
<div class="tpl-grid">
<button class="alert-tpl tpl-neg" onclick="document.getElementById('alertMsg').value='was absent today'"><div class="alert-icon">‚ùå</div><div class="alert-label">Absent</div></button>
<button class="alert-tpl tpl-neg" onclick="document.getElementById('alertMsg').value='has pending homework'"><div class="alert-icon">üìö</div><div class="alert-label">HW Due</div></button>
<button class="alert-tpl tpl-pos" onclick="document.getElementById('alertMsg').value='performed excellently!'"><div class="alert-icon">‚≠ê</div><div class="alert-label">Excellent</div></button>
<button class="alert-tpl tpl-warn" onclick="document.getElementById('alertMsg').value='has pending fees'"><div class="alert-icon">üí∞</div><div class="alert-label">Fee Due</div></button>
<button class="alert-tpl tpl-info" onclick="document.getElementById('alertMsg').value='Test tomorrow. Please prepare.'"><div class="alert-icon">üìù</div><div class="alert-label">Test</div></button>
<button class="alert-tpl tpl-info" onclick="document.getElementById('alertMsg').value='Tomorrow is holiday.'"><div class="alert-icon">üèñÔ∏è</div><div class="alert-label">Holiday</div></button>
</div>
<div class="form-group" style="margin-top:12px"><textarea id="alertMsg" rows="2" placeholder="Type message..."></textarea></div>
</div><div class="modal-footer"><button class="btn btn-sms" onclick="sendAlertSMS()">üì± SMS</button><button class="btn btn-wa" onclick="sendAlertWA()">üí¨ WhatsApp</button></div></div></div>
<div class="modal" id="wsModal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">üì§ Upload Worksheet</h2><button class="modal-close" onclick="closeM('wsModal')">√ó</button></div><div class="modal-body">
<div class="form-group"><label>Class</label><select id="wsClass"><option value="">Select</option><option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option><option>ALL</option></select></div>
<div class="form-group"><label>Subject</label><input type="text" id="wsSubject"></div>
<div class="form-group"><label>Title</label><input type="text" id="wsTitle"></div>
<div class="upload-box" onclick="document.getElementById('wsFile').click()"><div style="font-size:40px">üìÅ</div><div style="color:#667eea;font-weight:600">Click to Select</div></div>
<div class="file-preview" id="filePreview"><span style="font-size:24px">üìÑ</span><span id="fileName" style="flex:1"></span><button onclick="document.getElementById('wsFile').value='';document.getElementById('filePreview').style.display='none';document.querySelector('.upload-box').style.display='block'" style="background:#ff6b6b;color:#fff;border:none;width:28px;height:28px;border-radius:8px">√ó</button></div>
<input type="file" id="wsFile" style="display:none" onchange="if(this.files.length){document.getElementById('fileName').textContent=this.files[0].name;document.getElementById('filePreview').style.display='flex';document.querySelector('.upload-box').style.display='none'}">
</div><div class="modal-footer"><button class="btn btn-green" onclick="saveWs()">üì§ Upload</button></div></div></div>
<div class="toast" id="toast"></div>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyA5FjFHqFRBiGlLVe-jn7njpfXzf8hQ1cY",authDomain:"unique-study-point-2.firebaseapp.com",databaseURL:"https://unique-study-point-2-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"unique-study-point-2"});
var db=firebase.database(),cu=null,ut='parent',stu=[],tst=[],res=[],att=[],fee=[],alerts=[],worksheets=[],ctid=null,curFilter='all',wsFilter='all',lineChart=null,pieChart=null,addPhotoUrl='',editPhotoUrl='',
td=new Date().toISOString().split('T')[0],
SMS_KEY='P3WtxzoqRgB58mSnZ1vJAwGQ2p7UTY0ci6dLjlhbkDCf4auKHI2qKczUL1AMVRj6WSDItJekFaZxP8no',
CLOUD='dukrrfqf6',PHONE='8103405051';
document.getElementById('tD').value=td;document.getElementById('fDate').value=td;document.getElementById('attD').value=td;document.getElementById('sJoin').value=td;
function toast(m,t){var e=document.getElementById('toast');e.textContent=m;e.className='toast show '+(t||'');setTimeout(function(){e.classList.remove('show')},3000)}
function openM(id){document.getElementById(id).classList.add('active')}
function closeM(id){document.getElementById(id).classList.remove('active')}
function logout(){cu=null;localStorage.removeItem('usp_user');location.reload()}
function sendSMS(n,m){fetch('https://www.fast2sms.com/dev/bulkV2?authorization='+SMS_KEY+'&route=q&message='+encodeURIComponent(m)+'&flash=0&numbers='+n,{method:'GET',mode:'no-cors'});toast('SMS Sent!','success')}
function formatDate(d){return d?new Date(d).toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'}):'N/A'}
function uploadCloud(f,cb){var fd=new FormData();fd.append('file',f);fd.append('upload_preset','ml_default');fetch('https://api.cloudinary.com/v1_1/'+CLOUD+'/auto/upload',{method:'POST',body:fd}).then(function(r){return r.json()}).then(function(d){cb(d.secure_url||null)}).catch(function(){cb(null)})}
function uploadPhoto(inp,type){if(inp.files.length){toast('Uploading...','');uploadCloud(inp.files[0],function(url){if(url){if(type==='add'){addPhotoUrl=url;document.getElementById('addPhotoBox').innerHTML='<img src="'+url+'">'}else{editPhotoUrl=url;document.getElementById('editPhotoBox').innerHTML='<img src="'+url+'">'}toast('Done!','success')}})}}
function getGrade(p){if(p>=90)return{g:'A+',c:'#27ae60',r:'Outstanding!'};if(p>=80)return{g:'A',c:'#2ecc71',r:'Excellent!'};if(p>=70)return{g:'B+',c:'#3498db',r:'Very Good!'};if(p>=60)return{g:'B',c:'#9b59b6',r:'Good effort.'};if(p>=50)return{g:'C',c:'#f1c40f',r:'Average.'};if(p>=40)return{g:'D',c:'#e67e22',r:'Needs work.'};return{g:'F',c:'#e74c3c',r:'Below expectations.'}}
db.ref('.info/connected').on('value',function(s){document.getElementById('connStatus').textContent=s.val()?'‚úÖ Connected':'‚ö†Ô∏è Offline'});
db.ref('students').on('value',function(s){stu=[];s.forEach(function(c){stu.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('tests').on('value',function(s){tst=[];s.forEach(function(c){if(c.val()&&c.val().name)tst.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('results').on('value',function(s){res=[];s.forEach(function(c){res.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('attendance').on('value',function(s){att=[];s.forEach(function(c){att.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('fees').on('value',function(s){fee=[];s.forEach(function(c){fee.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('alerts').on('value',function(s){alerts=[];s.forEach(function(c){alerts.push(Object.assign({id:c.key},c.val()))});render()});
db.ref('worksheets').on('value',function(s){worksheets=[];s.forEach(function(c){worksheets.push(Object.assign({id:c.key},c.val()))});render()});
var sv=localStorage.getItem('usp_user');if(sv){cu=JSON.parse(sv);if(cu.role==='admin')showAdmin();else showParent()}
document.getElementById('loginBtn').onclick=function(){var u=document.getElementById('userId').value.trim(),p=document.getElementById('password').value;if(!u||!p)return toast('Enter credentials','error');if(ut==='admin'){if(u==='admin'&&p==='admin123'){cu={role:'admin'};localStorage.setItem('usp_user',JSON.stringify(cu));showAdmin()}else toast('Invalid','error')}else{var s=stu.find(function(x){return x.userId===u&&x.password===p});if(s){cu={role:'parent',id:s.id,name:s.name};localStorage.setItem('usp_user',JSON.stringify(cu));showParent()}else toast('Invalid','error')}};
function showAdmin(){document.getElementById('loginPage').style.display='none';document.getElementById('adminDash').classList.add('active');initAdmin();toast('Welcome Admin!','success')}
function showParent(){document.getElementById('loginPage').style.display='none';document.getElementById('parentDash').classList.add('active');initParent();toast('Welcome!','success')}
function initParent(){
document.getElementById('pNav').innerHTML='<button class="nav-item active" onclick="showPage(\'pHome\',\'pNav\')"><span>üè†</span><span>Home</span></button><button class="nav-item" onclick="showPage(\'pResults\',\'pNav\')"><span>üìù</span><span>Results</span></button><button class="nav-item" onclick="showPage(\'pProgress\',\'pNav\');renPProgress()"><span>üìä</span><span>Progress</span></button><button class="nav-item" onclick="showPage(\'pAttendance\',\'pNav\');renPAtt()"><span>üìã</span><span>Attend</span></button><button class="nav-item" onclick="showPage(\'pFees\',\'pNav\')"><span>üí∞</span><span>Fees</span></button>';
document.getElementById('resFilters').innerHTML='<button class="filter-btn active" onclick="setResFilter(this,\'all\')">All</button><button class="filter-btn" onclick="setResFilter(this,\'5\')">Last 5</button><button class="filter-btn" onclick="setResFilter(this,\'10\')">Last 10</button><button class="filter-btn" onclick="setResFilter(this,\'Mathematics\')">Maths</button><button class="filter-btn" onclick="setResFilter(this,\'Science\')">Science</button><button class="filter-btn" onclick="setResFilter(this,\'Social Science\')">Social Science</button>';
}
function initAdmin(){
document.getElementById('aNav').innerHTML='<button class="nav-item active" onclick="showPage(\'aHome\',\'aNav\')"><span>üè†</span><span>Home</span></button><button class="nav-item" onclick="showPage(\'aAtt\',\'aNav\');renAtt()"><span>üìã</span><span>Attend</span></button><button class="nav-item" onclick="showPage(\'aTests\',\'aNav\')"><span>üìù</span><span>Tests</span></button><button class="nav-item" onclick="showPage(\'aWorksheets\',\'aNav\');renAWs()"><span>üìö</span><span>Sheets</span></button><button class="nav-item" onclick="showPage(\'aFees\',\'aNav\')"><span>üí∞</span><span>Fees</span></button>';
document.getElementById('quickActions').innerHTML='<button class="action" onclick="openM(\'addSModal\')"><div class="action-icon">‚ûï</div><div class="action-label">Add Student</div></button><button class="action" onclick="showPage(\'aAtt\',\'aNav\');renAtt()"><div class="action-icon">üìã</div><div class="action-label">Attendance</div></button><button class="action" onclick="openM(\'addTModal\')"><div class="action-icon">üìù</div><div class="action-label">Add Test</div></button><button class="action" onclick="ldDD();openM(\'alertModal\')"><div class="action-icon">üîî</div><div class="action-label">Send Alert</div></button>';
document.getElementById('clsFilters').innerHTML='<button class="filter-btn active" onclick="setClsFilter(this,\'all\')">All</button><button class="filter-btn" onclick="setClsFilter(this,\'VI\')">VI</button><button class="filter-btn" onclick="setClsFilter(this,\'VII\')">VII</button><button class="filter-btn" onclick="setClsFilter(this,\'VIII\')">VIII</button><button class="filter-btn" onclick="setClsFilter(this,\'IX\')">IX</button><button class="filter-btn" onclick="setClsFilter(this,\'X\')">X</button>';
document.getElementById('wsClsFilters').innerHTML='<button class="filter-btn active" onclick="setWsFilter(this,\'all\')">All</button><button class="filter-btn" onclick="setWsFilter(this,\'VI\')">VI</button><button class="filter-btn" onclick="setWsFilter(this,\'VII\')">VII</button><button class="filter-btn" onclick="setWsFilter(this,\'VIII\')">VIII</button>';
}
function showPage(pid,navId){var dash=navId==='pNav'?'parentDash':'adminDash';document.querySelectorAll('#'+dash+' .page').forEach(function(p){p.classList.remove('active')});document.getElementById(pid).classList.add('active');document.querySelectorAll('#'+navId+' .nav-item').forEach(function(b){b.classList.remove('active')});event.target.closest('.nav-item').classList.add('active')}
function setResFilter(btn,f){document.querySelectorAll('#resFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');renPRes(f)}
function setClsFilter(btn,c){document.querySelectorAll('#clsFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');curFilter=c;renStu()}
function setWsFilter(btn,c){document.querySelectorAll('#wsClsFilters .filter-btn').forEach(function(b){b.classList.remove('active')});btn.classList.add('active');wsFilter=c;renAWs()}
function render(){if(cu&&cu.role==='admin'){updAdmin();renStu();renTests();renFees();renAWs();ldDD()}if(cu&&cu.role==='parent'){renPHome();renPRes('all');renPFees()}}
function renPHome(){if(!cu||cu.role!=='parent')return;var s=stu.find(function(x){return x.id===cu.id});if(!s)return;if(s.photo)document.getElementById('pPhoto').innerHTML='<img src="'+s.photo+'">';else document.getElementById('pInit').textContent=s.name?s.name.charAt(0):'S';document.getElementById('pWelcome').textContent='Welcome, '+(s.name||'');var pres=att.filter(function(a){return a.sid===cu.id&&a.status==='present'}).length;document.getElementById('pAttDays').textContent=pres;var myRes=res.filter(function(r){return r.sid===cu.id}),avgPct=0;if(myRes.length){var t=0;myRes.forEach(function(r){var test=tst.find(function(x){return x.id===r.tid});if(test)t+=Math.round((r.marks/test.totalMarks)*100)});avgPct=Math.round(t/myRes.length)}document.getElementById('pAvgPct').textContent=avgPct+'%';document.getElementById('pTestCnt').textContent=myRes.length;var myAlerts=alerts.filter(function(a){return a.sid===cu.id||a.sid==='ALL'}).sort(function(a,b){return(b.time||0)-(a.time||0)}).slice(0,5),html='';myAlerts.forEach(function(a){html+='<div class="card"><div class="avatar">üîî</div><div class="card-info"><div class="card-title">'+a.msg+'</div><div class="card-sub">'+formatDate(a.time)+'</div></div></div>'});document.getElementById('notifList').innerHTML=html||'<div class="empty">No notifications</div>'}
function renPRes(filter){if(!cu||cu.role!=='parent')return;var myRes=[];res.filter(function(r){return r.sid===cu.id}).forEach(function(r){var t=tst.find(function(x){return x.id===r.tid});if(t)myRes.push({marks:r.marks,test:t})});myRes.sort(function(a,b){return(b.test.createdAt||0)-(a.test.createdAt||0)});if(filter==='5')myRes=myRes.slice(0,5);else if(filter==='10')myRes=myRes.slice(0,10);else if(filter==='Mathematics'||filter==='Science'||filter==='Social Science')myRes=myRes.filter(function(r){return r.test.subject===filter});var html='';myRes.forEach(function(r){var pct=Math.round((r.marks/r.test.totalMarks)*100),g=getGrade(pct);html+='<div class="result-card"><div class="score-circle" style="background:'+g.c+'">'+g.g+'</div><div class="card-info"><div class="card-title">'+r.test.name+' - '+pct+'%</div><div class="card-sub">'+r.marks+'/'+r.test.totalMarks+' ‚Ä¢ '+r.test.subject+'</div></div></div>'});document.getElementById('resultsList').innerHTML=html||'<div class="empty">No results</div>'}
function renPProgress(){if(!cu||cu.role!=='parent')return;var myRes=[];res.filter(function(r){return r.sid===cu.id}).forEach(function(r){var t=tst.find(function(x){return x.id===r.tid});if(t)myRes.push({marks:r.marks,test:t})});myRes.sort(function(a,b){return(a.test.createdAt||0)-(b.test.createdAt||0)});var labels=[],data=[];myRes.forEach(function(r){labels.push(r.test.name.substring(0,6));data.push(Math.round((r.marks/r.test.totalMarks)*100))});if(lineChart)lineChart.destroy();lineChart=new Chart(document.getElementById('lineChart'),{type:'line',data:{labels:labels,datasets:[{data:data,borderColor:'#667eea',backgroundColor:'rgba(102,126,234,0.1)',fill:true,tension:0.4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}});var subjects={};myRes.forEach(function(r){var subj=r.test.subject;if(!subjects[subj])subjects[subj]={total:0,cnt:0};subjects[subj].total+=Math.round((r.marks/r.test.totalMarks)*100);subjects[subj].cnt++});var subLabels=Object.keys(subjects),subData=subLabels.map(function(s){return Math.round(subjects[s].total/subjects[s].cnt)});if(pieChart)pieChart.destroy();pieChart=new Chart(document.getElementById('pieChart'),{type:'doughnut',data:{labels:subLabels,datasets:[{data:subData,backgroundColor:['#667eea','#f093fb','#25D366','#ffd700','#ff6b6b']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}}}})}
function renPAtt(){if(!cu||cu.role!=='parent')return;var myAtt=att.filter(function(a){return a.sid===cu.id}),total=myAtt.length,pres=myAtt.filter(function(a){return a.status==='present'}).length;document.getElementById('pTotalDays').textContent=total;document.getElementById('pPresentDays').textContent=pres;document.getElementById('pAttPercent').textContent=total?Math.round((pres/total)*100)+'%':'0%';var months={};myAtt.forEach(function(a){var d=new Date(a.date),k=d.toLocaleString('en-IN',{month:'long',year:'numeric'});if(!months[k])months[k]={p:0,a:0};if(a.status==='present')months[k].p++;else months[k].a++});var html='';Object.keys(months).reverse().forEach(function(k){var m=months[k],mp=Math.round((m.p/(m.p+m.a))*100);html+='<div class="att-detail"><h4 style="color:#667eea;margin-bottom:10px">üìÖ '+k+'</h4><div class="att-row"><span>Present</span><span style="color:#25D366;font-weight:700">'+m.p+'</span></div><div class="att-row"><span>Absent</span><span style="color:#ff6b6b;font-weight:700">'+m.a+'</span></div><div class="att-row"><span>%</span><span style="color:#667eea;font-weight:700">'+mp+'%</span></div></div>'});document.getElementById('attMonthList').innerHTML=html||'<div class="empty">No records</div>'}
function downloadAttPDF(){var s=stu.find(function(x){return x.id===cu.id});if(!s)return;var myAtt=att.filter(function(a){return a.sid===cu.id});if(!myAtt.length)return toast('No records','error');var jsPDF=window.jspdf.jsPDF,doc=new jsPDF();doc.setFillColor(102,126,234);doc.rect(0,0,210,40,'F');doc.setTextColor(255);doc.setFontSize(20);doc.text('UNIQUE STUDY POINT',105,18,{align:'center'});doc.setFontSize(10);doc.text('Attendance: '+s.name,105,30,{align:'center'});var months={};myAtt.forEach(function(a){var d=new Date(a.date),k=d.toLocaleString('en-IN',{month:'long',year:'numeric'});if(!months[k])months[k]=[];months[k].push(a)});var tableData=[],total=myAtt.length,totalP=myAtt.filter(function(a){return a.status==='present'}).length;Object.keys(months).forEach(function(k){var m=months[k],p=m.filter(function(a){return a.status==='present'}).length;tableData.push([k,p,m.length-p,m.length,Math.round((p/m.length)*100)+'%'])});tableData.push(['TOTAL',totalP,total-totalP,total,Math.round((totalP/total)*100)+'%']);doc.autoTable({startY:50,head:[['Month','Present','Absent','Total','%']],body:tableData,theme:'grid',headStyles:{fillColor:[102,126,234]}});doc.save(s.name+'_Attendance.pdf');toast('Downloaded!','success')}
function renPFees(){if(!cu||cu.role!=='parent')return;var s=stu.find(function(x){return x.id===cu.id});if(!s)return;var myFee=fee.filter(function(f){return f.sid===cu.id}),paid=myFee.reduce(function(t,f){return t+f.amount},0);var join=new Date(s.joinDate||td),now=new Date(),months=Math.max(1,(now.getFullYear()-join.getFullYear())*12+(now.getMonth()-join.getMonth())+1),due=(s.fee||500)*months,pending=Math.max(0,due-paid);document.getElementById('feePend').textContent='‚Çπ'+pending;document.getElementById('feeStat').textContent=pending>0?'‚ö†Ô∏è Due':'‚úÖ Clear';var html='';myFee.sort(function(a,b){return new Date(b.date)-new Date(a.date)}).forEach(function(f){html+='<div class="card"><div class="avatar" style="background:#d4fc79;color:#333">üí∞</div><div class="card-info"><div class="card-title">‚Çπ'+f.amount+'</div><div class="card-sub">'+formatDate(f.date)+'</div></div></div>'});document.getElementById('feeList').innerHTML=html||'<div class="empty">No payments</div>'}
function viewReport(){var s=stu.find(function(x){return x.id===cu.id});if(!s)return;var myRes=[];res.filter(function(r){return r.sid===cu.id}).forEach(function(r){var t=tst.find(function(x){return x.id===r.tid});if(t)myRes.push({marks:r.marks,test:t})});if(!myRes.length)return toast('No results','error');var totalPct=0;myRes.forEach(function(r){totalPct+=Math.round((r.marks/r.test.totalMarks)*100)});var avgPct=Math.round(totalPct/myRes.length),overall=getGrade(avgPct);var subjects={};myRes.forEach(function(r){var subj=r.test.subject,pct=Math.round((r.marks/r.test.totalMarks)*100);if(!subjects[subj])subjects[subj]={total:0,cnt:0,marks:0,max:0};subjects[subj].total+=pct;subjects[subj].cnt++;subjects[subj].marks+=r.marks;subjects[subj].max+=r.test.totalMarks});var html='<div style="text-align:center;margin-bottom:20px"><div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:20px;border-radius:16px;color:#fff"><h2>UNIQUE STUDY POINT</h2><p>By Sumeet Sahu</p></div>';if(s.photo)html+='<img src="'+s.photo+'" style="width:80px;height:80px;border-radius:50%;margin-top:15px;border:3px solid #667eea;object-fit:cover">';html+='<h3 style="margin-top:10px">'+s.name+'</h3><p style="color:#888">Class '+(s.class||'')+'</p></div>';html+='<div class="chart-container"><h4 style="color:#667eea;margin-bottom:15px">üìä Summary</h4><div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;text-align:center"><div style="background:#f8f9fa;padding:15px;border-radius:12px"><div style="font-size:24px;font-weight:800;color:'+overall.c+'">'+overall.g+'</div><div style="font-size:10px;color:#888">GRADE</div></div><div style="background:#f8f9fa;padding:15px;border-radius:12px"><div style="font-size:24px;font-weight:800;color:#667eea">'+avgPct+'%</div><div style="font-size:10px;color:#888">AVERAGE</div></div><div style="background:#f8f9fa;padding:15px;border-radius:12px"><div style="font-size:24px;font-weight:800;color:#667eea">'+myRes.length+'</div><div style="font-size:10px;color:#888">TESTS</div></div></div></div>';html+='<div class="chart-container"><h4 style="color:#667eea;margin-bottom:15px">üìà Trend</h4><canvas id="reportLineChart" height="150"></canvas></div>';html+='<div class="chart-container"><h4 style="color:#667eea;margin-bottom:15px">üìù Subject Remarks</h4>';Object.keys(subjects).forEach(function(subj){var avg=Math.round(subjects[subj].total/subjects[subj].cnt),g=getGrade(avg);html+='<div class="subject-row"><div><div style="font-weight:600">'+subj+'</div><div style="font-size:10px;color:#888">'+g.r+'</div></div><div style="text-align:right"><div style="color:#667eea;font-weight:600">'+subjects[subj].marks+'/'+subjects[subj].max+'</div><div style="font-size:11px;color:'+g.c+';font-weight:700">'+avg+'% ('+g.g+')</div></div></div>'});html+='<div class="remark-box"><strong>Overall:</strong> '+overall.r+'</div></div>';document.getElementById('reportContent').innerHTML=html;document.getElementById('reportView').classList.add('active');setTimeout(function(){var labels=[],data=[];myRes.forEach(function(r){labels.push(r.test.name.substring(0,6));data.push(Math.round((r.marks/r.test.totalMarks)*100))});new Chart(document.getElementById('reportLineChart'),{type:'line',data:{labels:labels,datasets:[{data:data,borderColor:'#667eea',backgroundColor:'rgba(102,126,234,0.1)',fill:true,tension:0.4}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{min:0,max:100}}}})},100)}
function closeReport(){document.getElementById('reportView').classList.remove('active')}
function downloadReport(){var s=stu.find(function(x){return x.id===cu.id});if(!s)return;var myRes=[];res.filter(function(r){return r.sid===cu.id}).forEach(function(r){var t=tst.find(function(x){return x.id===r.tid});if(t)myRes.push({marks:r.marks,test:t})});if(!myRes.length)return toast('No results','error');var totalPct=0;myRes.forEach(function(r){totalPct+=Math.round((r.marks/r.test.totalMarks)*100)});var avgPct=Math.round(totalPct/myRes.length),overall=getGrade(avgPct);var jsPDF=window.jspdf.jsPDF,doc=new jsPDF();doc.setFillColor(102,126,234);doc.rect(0,0,210,45,'F');doc.setTextColor(255);doc.setFontSize(22);doc.text('UNIQUE STUDY POINT',105,20,{align:'center'});doc.setFontSize(10);doc.text('Progress Report - '+s.name,105,32,{align:'center'});var tableData=[];myRes.forEach(function(r,i){var pct=Math.round((r.marks/r.test.totalMarks)*100),g=getGrade(pct);tableData.push([i+1,r.test.name,r.test.subject,r.marks+'/'+r.test.totalMarks,pct+'%',g.g])});doc.autoTable({startY:55,head:[['#','Test','Subject','Marks','%','Grade']],body:tableData,theme:'grid',headStyles:{fillColor:[102,126,234]}});doc.save(s.name+'_Report.pdf');toast('Downloaded!','success')}
function updAdmin(){document.getElementById('aStu').textContent=stu.length;document.getElementById('aTst').textContent=tst.length;document.getElementById('aPre').textContent=att.filter(function(a){return a.date===td&&a.status==='present'}).length}
function renStu(){var f=curFilter==='all'?stu:stu.filter(function(s){return s.class===curFilter});var html='';f.forEach(function(s){var av=s.photo?'<img src="'+s.photo+'">':s.name.charAt(0);html+='<div class="card" style="cursor:pointer" onclick="openEditS(\''+s.id+'\')"><div class="avatar">'+av+'</div><div class="card-info"><div class="card-title">'+s.name+'</div><div class="card-sub">Class '+s.class+' ‚Ä¢ '+s.mobile+'</div></div></div>'});document.getElementById('aList').innerHTML=html||'<div class="empty">No students</div>'}
function openEditS(id){var s=stu.find(function(x){return x.id===id});if(!s)return;document.getElementById('editSId').value=s.id;document.getElementById('editSN').value=s.name;document.getElementById('editSC').value=s.class;document.getElementById('editSM').value=s.mobile;document.getElementById('editSU').value=s.userId;document.getElementById('editSP').value=s.password;document.getElementById('editSFee').value=s.fee||500;document.getElementById('editSJoin').value=s.joinDate||td;editPhotoUrl=s.photo||'';document.getElementById('editPhotoBox').innerHTML=s.photo?'<img src="'+s.photo+'">':'<span style="font-size:28px">üì∑</span>';openM('editSModal')}
function saveStudent(){var n=document.getElementById('sN').value.trim(),c=document.getElementById('sC').value,m=document.getElementById('sM').value.trim(),u=document.getElementById('sU').value.trim(),p=document.getElementById('sP').value.trim(),f=document.getElementById('sFee').value,j=document.getElementById('sJoin').value;if(!n||!c||!m||!u||!p)return toast('Fill all','error');if(m.length!==10)return toast('Mobile: 10 digits','error');db.ref('students').push({name:n,class:c,mobile:m,userId:u,password:p,fee:parseInt(f)||500,joinDate:j,photo:addPhotoUrl}).then(function(){closeM('addSModal');document.getElementById('sN').value='';document.getElementById('sC').value='';document.getElementById('sM').value='';document.getElementById('sU').value='';document.getElementById('sP').value='';addPhotoUrl='';document.getElementById('addPhotoBox').innerHTML='<span style="font-size:28px">üì∑</span>';toast('Added!','success')})}
function updateStudent(){var id=document.getElementById('editSId').value,n=document.getElementById('editSN').value.trim(),c=document.getElementById('editSC').value,m=document.getElementById('editSM').value.trim(),u=document.getElementById('editSU').value.trim(),p=document.getElementById('editSP').value.trim(),f=document.getElementById('editSFee').value,j=document.getElementById('editSJoin').value;if(!n||!c||!m||!u||!p)return toast('Fill all','error');db.ref('students/'+id).update({name:n,class:c,mobile:m,userId:u,password:p,fee:parseInt(f)||500,joinDate:j,photo:editPhotoUrl}).then(function(){closeM('editSModal');toast('Updated!','success')})}
function deleteStudent(){var id=document.getElementById('editSId').value,name=document.getElementById('editSN').value;if(confirm('Delete '+name+'?')){db.ref('students/'+id).remove();['attendance','results','fees','alerts'].forEach(function(path){db.ref(path).orderByChild('sid').equalTo(id).once('value',function(s){s.forEach(function(c){db.ref(path+'/'+c.key).remove()})})});closeM('editSModal');toast('Deleted!','success')}}
function renAtt(){var d=document.getElementById('attD').value||td,html='';stu.forEach(function(s){var a=att.find(function(x){return x.sid===s.id&&x.date===d}),st=a?a.status:'',av=s.photo?'<img src="'+s.photo+'">':s.name.charAt(0);html+='<div class="card"><div class="avatar">'+av+'</div><div class="card-info"><div class="card-title">'+s.name+'</div><div class="card-sub">'+s.class+'</div></div><div style="display:flex;gap:5px"><button class="btn-small" style="background:'+(st==='present'?'#25D366':'#e8e8e8')+';color:'+(st==='present'?'#fff':'#333')+'" onclick="mAtt(\''+s.id+'\',\'present\',this)">‚úì</button><button class="btn-small" style="background:'+(st==='absent'?'#ff6b6b':'#e8e8e8')+';color:'+(st==='absent'?'#fff':'#333')+'" onclick="mAtt(\''+s.id+'\',\'absent\',this)">‚úó</button></div></div>'});document.getElementById('attL').innerHTML=html}
function mAtt(sid,st,btn){var d=document.getElementById('attD').value||td,ex=att.find(function(a){return a.sid===sid&&a.date===d});if(ex)db.ref('attendance/'+ex.id).update({status:st});else db.ref('attendance').push({sid:sid,date:d,status:st});var sibs=btn.parentElement.querySelectorAll('.btn-small');sibs.forEach(function(b){b.style.background='#e8e8e8';b.style.color='#333'});btn.style.background=st==='present'?'#25D366':'#ff6b6b';btn.style.color='#fff';toast('Marked!','success')}
function sendAttSMS(){var d=document.getElementById('attD').value||td,absent=stu.filter(function(s){return att.find(function(a){return a.sid===s.id&&a.date===d&&a.status==='absent'})});if(absent.length){sendSMS(absent.map(function(s){return s.mobile}).join(','),'UNIQUE STUDY POINT: Your ward was ABSENT on '+formatDate(d)+'. -Sumeet Sahu');toast('SMS sent to '+absent.length,'success')}else toast('No absent','error')}
function sendAttWA(){var d=document.getElementById('attD').value||td,idx=0;stu.forEach(function(s){var a=att.find(function(x){return x.sid===s.id&&x.date===d});if(a){var status=a.status==='present'?'PRESENT ‚úÖ':'ABSENT ‚ùå';setTimeout(function(){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n'+s.name+'\n'+formatDate(d)+': '+status+'\n-Sumeet Sahu'),'_blank')},idx*1500);idx++}});if(idx)toast('Opening WA...','success')}
function renTests(){var sorted=tst.slice().sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0)});var html='';sorted.forEach(function(t){var cnt=res.filter(function(r){return r.tid===t.id}).length;html+='<div class="test-card"><div style="font-weight:700;font-size:14px;margin-bottom:4px">'+t.name+'</div><div style="font-size:11px;color:#888;margin-bottom:10px">üìñ '+t.subject+' ‚Ä¢ üìÖ '+formatDate(t.date)+' ‚Ä¢ '+t.totalMarks+' marks ‚Ä¢ '+cnt+' results</div><div style="display:flex;gap:8px;flex-wrap:wrap"><button class="btn-small" style="background:#667eea" onclick="openMk(\''+t.id+'\')">üìù Marks</button><button class="btn-small" style="background:#f093fb" onclick="openEditT(\''+t.id+'\')">‚úèÔ∏è</button><button class="btn-small btn-del" onclick="delTest(\''+t.id+'\',\''+t.name+'\')">üóëÔ∏è</button></div></div>'});document.getElementById('testL').innerHTML=html||'<div class="empty">No tests</div>'}
function openEditT(id){var t=tst.find(function(x){return x.id===id});if(!t)return;document.getElementById('editTId').value=t.id;document.getElementById('editTN').value=t.name;document.getElementById('editTS').value=t.subject;document.getElementById('editTM').value=t.totalMarks;document.getElementById('editTD').value=t.date||'';openM('editTModal')}
function saveTest(){var n=document.getElementById('tN').value.trim(),subj=document.getElementById('tSubjSel').value,m=document.getElementById('tM').value,d=document.getElementById('tD').value,notify=document.getElementById('tNotify').checked;if(subj==='other')subj=document.getElementById('tSOther').value.trim();if(!n||!subj)return toast('Fill name & subject','error');db.ref('tests').push({name:n,subject:subj,totalMarks:parseInt(m)||100,date:d,createdAt:Date.now()}).then(function(){if(notify&&stu.length){sendSMS(stu.map(function(s){return s.mobile}).join(','),'UNIQUE STUDY POINT: Test "'+n+'" ('+subj+') on '+formatDate(d)+'. -Sumeet Sahu');db.ref('alerts').push({sid:'ALL',msg:'Test: '+n+' on '+formatDate(d),time:Date.now()})}closeM('addTModal');document.getElementById('tN').value='';document.getElementById('tSubjSel').value='';document.getElementById('tSOther').value='';document.getElementById('otherSubjGroup').style.display='none';document.getElementById('tNotify').checked=false;toast('Created!','success')})}
function updateTest(){var id=document.getElementById('editTId').value,n=document.getElementById('editTN').value.trim(),s=document.getElementById('editTS').value.trim(),m=document.getElementById('editTM').value,d=document.getElementById('editTD').value;if(!n||!s)return toast('Fill all','error');db.ref('tests/'+id).update({name:n,subject:s,totalMarks:parseInt(m)||100,date:d}).then(function(){closeM('editTModal');toast('Updated!','success')})}
function deleteTest(){var id=document.getElementById('editTId').value,name=document.getElementById('editTN').value;delTest(id,name);closeM('editTModal')}
function delTest(id,name){if(confirm('Delete '+name+'?')){db.ref('tests/'+id).remove();db.ref('results').orderByChild('tid').equalTo(id).once('value',function(s){s.forEach(function(c){db.ref('results/'+c.key).remove()})});toast('Deleted!','success')}}
function openMk(tid){ctid=tid;var t=tst.find(function(x){return x.id===tid});if(!t)return;document.getElementById('mkTN').textContent=t.name+' ('+t.totalMarks+')';var html='';stu.forEach(function(s){var r=res.find(function(x){return x.tid===tid&&x.sid===s.id}),av=s.photo?'<img src="'+s.photo+'">':s.name.charAt(0);html+='<div class="card"><div class="avatar">'+av+'</div><div class="card-info"><div class="card-title">'+s.name+' <small style="color:#888">('+s.class+')</small></div></div><input type="number" id="mk_'+s.id+'" value="'+(r?r.marks:'')+'" placeholder="Marks" style="width:70px;padding:8px;border:2px solid #e8e8e8;border-radius:8px"></div>'});document.getElementById('mkL').innerHTML=html;openM('addMkModal')}
function saveMk(){stu.forEach(function(s){var v=document.getElementById('mk_'+s.id);if(v&&v.value!==''){var ex=res.find(function(r){return r.tid===ctid&&r.sid===s.id});if(ex)db.ref('results/'+ex.id).update({marks:parseInt(v.value)});else db.ref('results').push({tid:ctid,sid:s.id,marks:parseInt(v.value)})}});closeM('addMkModal');toast('Saved!','success')}
function sendMkSMS(){var t=tst.find(function(x){return x.id===ctid});if(!t)return;var nums=stu.filter(function(s){return res.find(function(r){return r.tid===ctid&&r.sid===s.id})}).map(function(s){return s.mobile});if(nums.length)sendSMS(nums.join(','),'UNIQUE STUDY POINT: '+t.name+' results out. Check app. -Sumeet Sahu')}
function sendMkWA(){var t=tst.find(function(x){return x.id===ctid});if(!t)return;var idx=0;stu.forEach(function(s){var r=res.find(function(x){return x.tid===ctid&&x.sid===s.id});if(r){var pct=Math.round((r.marks/t.totalMarks)*100);setTimeout(function(){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n'+s.name+'\n'+t.name+': '+r.marks+'/'+t.totalMarks+' ('+pct+'%)\n-Sumeet Sahu'),'_blank')},idx*1500);idx++}});if(idx)toast('Opening WA...','success')}
function renAWs(){var f=wsFilter==='all'?worksheets:worksheets.filter(function(w){return w.class===wsFilter});f.sort(function(a,b){return(b.createdAt||0)-(a.createdAt||0)});var html='';f.forEach(function(w){html+='<div class="ws-card"><div style="font-weight:700;font-size:14px;margin-bottom:4px">'+w.title+'</div><div style="font-size:11px;color:#888;margin-bottom:10px">üìñ '+w.subject+' ‚Ä¢ '+w.class+' ‚Ä¢ '+formatDate(w.createdAt)+'</div><div style="display:flex;gap:8px"><a href="'+w.url+'" target="_blank" class="btn-small" style="background:#667eea;text-decoration:none">üì•</a><button class="btn-small btn-del" onclick="delWs(\''+w.id+'\')">üóëÔ∏è</button></div></div>'});document.getElementById('aWsList').innerHTML=html||'<div class="empty">No worksheets</div>'}
function delWs(id){if(confirm('Delete?')){db.ref('worksheets/'+id).remove();toast('Deleted!','success')}}
function renFees(){var sorted=fee.slice().sort(function(a,b){return new Date(b.date)-new Date(a.date)});var html='';sorted.forEach(function(f){var s=stu.find(function(x){return x.id===f.sid});if(s)html+='<div class="card"><div class="avatar">üí∞</div><div class="card-info"><div class="card-title">'+s.name+'</div><div class="card-sub">‚Çπ'+f.amount+' ‚Ä¢ '+formatDate(f.date)+'</div></div></div>'});document.getElementById('feeL').innerHTML=html||'<div class="empty">No payments</div>'}
function ldDD(){var opts='<option value="">Select</option><option value="ALL">üì¢ ALL STUDENTS</option>';stu.forEach(function(s){opts+='<option value="'+s.id+'">'+s.name+' ('+s.class+')</option>'});document.getElementById('alertStu').innerHTML=opts;document.getElementById('fStu').innerHTML='<option value="">Select</option>'+stu.map(function(s){return'<option value="'+s.id+'">'+s.name+'</option>'}).join('')}
function saveFee(){var sid=document.getElementById('fStu').value,amt=document.getElementById('fAmt').value,d=document.getElementById('fDate').value;if(!sid||!amt)return toast('Fill all','error');db.ref('fees').push({sid:sid,amount:parseInt(amt),date:d}).then(function(){closeM('addFModal');document.getElementById('fAmt').value='';toast('Saved!','success')})}
function sendAlertSMS(){var sid=document.getElementById('alertStu').value,msg=document.getElementById('alertMsg').value.trim();if(!sid)return toast('Select student','error');if(!msg)return toast('Enter message','error');if(sid==='ALL'){sendSMS(stu.map(function(s){return s.mobile}).join(','),'UNIQUE STUDY POINT: '+msg+' -Sumeet Sahu');db.ref('alerts').push({sid:'ALL',msg:msg,time:Date.now()})}else{var s=stu.find(function(x){return x.id===sid});if(s){sendSMS(s.mobile,'UNIQUE STUDY POINT: '+s.name+' '+msg+' -Sumeet Sahu');db.ref('alerts').push({sid:sid,msg:s.name+' '+msg,time:Date.now()})}}closeM('alertModal');document.getElementById('alertMsg').value=''}
function sendAlertWA(){var sid=document.getElementById('alertStu').value,msg=document.getElementById('alertMsg').value.trim();if(!sid)return toast('Select student','error');if(!msg)return toast('Enter message','error');if(sid==='ALL'){var idx=0;stu.forEach(function(s){setTimeout(function(){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n\n'+msg+'\n\n-Sumeet Sahu'),'_blank')},idx*1500);idx++});db.ref('alerts').push({sid:'ALL',msg:msg,time:Date.now()})}else{var s=stu.find(function(x){return x.id===sid});if(s){window.open('https://wa.me/91'+s.mobile+'?text='+encodeURIComponent('UNIQUE STUDY POINT\n\n'+s.name+' '+msg+'\n\n-Sumeet Sahu'),'_blank');db.ref('alerts').push({sid:sid,msg:s.name+' '+msg,time:Date.now()})}}closeM('alertModal');document.getElementById('alertMsg').value='';toast('Opening WA...','success')}
function saveWs(){var cls=document.getElementById('wsClass').value,subj=document.getElementById('wsSubject').value.trim(),title=document.getElementById('wsTitle').value.trim(),fileInput=document.getElementById('wsFile');if(!cls||!subj||!title)return toast('Fill all','error');if(!fileInput.files.length)return toast('Select file','error');toast('Uploading...','');uploadCloud(fileInput.files[0],function(url){if(url){db.ref('worksheets').push({class:cls,subject:subj,title:title,url:url,createdAt:Date.now()}).then(function(){closeM('wsModal');document.getElementById('wsClass').value='';document.getElementById('wsSubject').value='';document.getElementById('wsTitle').value='';document.getElementById('wsFile').value='';document.getElementById('filePreview').style.display='none';document.querySelector('.upload-box').style.display='block';toast('Uploaded!','success')})}else toast('Upload failed','error')})}

function downloadAdminAttPDF(){var month=document.getElementById('attMonth').value;if(!month)return toast('Select month','error');var monthName=new Date(month+'-01').toLocaleDateString('en-IN',{month:'long',year:'numeric'});var monthAtt=att.filter(function(a){return a.date&&a.date.startsWith(month)});var stuData={};stu.forEach(function(s){stuData[s.id]={name:s.name,class:s.class,present:0,absent:0}});monthAtt.forEach(function(a){if(stuData[a.sid]){if(a.status==='present')stuData[a.sid].present++;else stuData[a.sid].absent++}});var jsPDF=window.jspdf.jsPDF,doc=new jsPDF();doc.setFillColor(26,26,46);doc.rect(0,0,210,45,'F');doc.setFillColor(233,69,96);doc.roundedRect(15,8,25,15,3,3,'F');doc.setTextColor(255);doc.setFontSize(12);doc.text('USP',27,18,{align:'center'});doc.setFontSize(18);doc.text('UNIQUE STUDY POINT',105,20,{align:'center'});doc.setFontSize(10);doc.text('Attendance - '+monthName,105,32,{align:'center'});doc.setFontSize(8);doc.text('www.uniquestudyonline.com',105,40,{align:'center'});var tableData=[];var keys=Object.keys(stuData);for(var i=0;i<keys.length;i++){var d=stuData[keys[i]],total=d.present+d.absent,pct=total>0?Math.round((d.present/total)*100):0;var remark=pct>=90?'Excellent':pct>=75?'Good':pct>=50?'Average':'Poor';tableData.push([i+1,d.name,d.class,d.present,d.absent,total,pct+'%',remark])}doc.autoTable({startY:50,head:[['#','Name','Class','P','A','Total','%','Remark']],body:tableData,theme:'striped',headStyles:{fillColor:[26,26,46]}});doc.setFillColor(26,26,46);doc.rect(0,282,210,15,'F');doc.setTextColor(255,215,0);doc.setFontSize(8);doc.text('www.uniquestudyonline.com | '+PHONE,105,290,{align:'center'});doc.save('Attendance_'+monthName.replace(' ','_')+'.pdf');toast('Downloaded!','success')}
</script>
</body>
</html>
